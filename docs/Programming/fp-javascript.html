
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>üìñ Professor Frisby's Mostly Adequate Guide to Functional Programming ¬∑ GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../Philosophy/" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    ‚≠ï Intro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="./">
            
                <a href="./">
            
                    
                    üöÄ Programming
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.2.1" data-path="fp-javascript.html">
            
                <a href="fp-javascript.html">
            
                    
                    üìñ Professor Frisby's Mostly Adequate Guide to Functional Programming
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../Philosophy/">
            
                <a href="../Philosophy/">
            
                    
                    üèõ Philosophy
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../Philosophy/consumerism.html">
            
                <a href="../Philosophy/consumerism.html">
            
                    
                    üí∞ Ê∂àË¥π‰∏ª‰πâ
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../Music/">
            
                <a href="../Music/">
            
                    
                    Ê®Ç Music
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../Motorcycles/">
            
                <a href="../Motorcycles/">
            
                    
                    üèç Motorcycles
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../Motorcycles/sport-riding-techniques.html">
            
                <a href="../Motorcycles/sport-riding-techniques.html">
            
                    
                    üìñ Sport Riding Techniques
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../Motorcycles/a-twist-of-the-wrist-1.html">
            
                <a href="../Motorcycles/a-twist-of-the-wrist-1.html">
            
                    
                    üìñ A Twist of the Wrist 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../Motorcycles/offroad.html">
            
                <a href="../Motorcycles/offroad.html">
            
                    
                    üîó How to ride a motorcycle off-road
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >üìñ Professor Frisby's Mostly Adequate Guide to Functional Programming</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="professor-frisbys-mostly-adequate-guide-to-functional-programming">Professor Frisby&apos;s Mostly Adequate Guide to Functional Programming</h1>
<p><a href="https://github.com/MostlyAdequate/mostly-adequate-guide" target="_blank">https://github.com/MostlyAdequate/mostly-adequate-guide</a></p>
<h2 id="2-&#x4E00;&#x7B49;&#x516C;&#x6C11;&#x7684;&#x51FD;&#x6570;">2) &#x4E00;&#x7B49;&#x516C;&#x6C11;&#x7684;&#x51FD;&#x6570;</h2>
<blockquote>
<p>&#x5F53;&#x6211;&#x4EEC;&#x8BF4;&#x51FD;&#x6570;&#x662F;&#x201C;&#x4E00;&#x7B49;&#x516C;&#x6C11;&#x201D;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x8BF4;&#x7684;&#x662F;&#x5B83;&#x4EEC;&#x548C;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x90FD;&#x4E00;&#x6837;...&#x51FD;&#x6570;&#x771F;&#x6CA1;&#x4EC0;&#x4E48;&#x7279;&#x6B8A;&#x7684;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x50CF;&#x5BF9;&#x5F85;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x4E00;&#x6837;&#x5BF9;&#x5F85;&#x5B83;&#x4EEC;&#x2014;&#x2014;&#x628A;&#x5B83;&#x4EEC;&#x5B58;&#x5728;&#x6570;&#x7EC4;&#x91CC;&#xFF0C;&#x5F53;&#x4F5C;&#x53C2;&#x6570;&#x4F20;&#x9012;&#xFF0C;&#x8D4B;&#x503C;&#x7ED9;&#x53D8;&#x91CF;...&#x7B49;&#x7B49;</p>
</blockquote>
<pre><code class="lang-javascript"><span class="hljs-comment">// A bad example...</span>
<span class="hljs-keyword">const</span> hi = name =&gt; <span class="hljs-string">`Hi <span class="hljs-subst">${name}</span>`</span>;
<span class="hljs-keyword">const</span> greeting = name =&gt; hi(name);

<span class="hljs-comment">// Could change to...</span>
<span class="hljs-keyword">const</span> greeting = hi;
greeting(<span class="hljs-string">&quot;times&quot;</span>);
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// A worse example...</span>
<span class="hljs-keyword">const</span> getServerStuff = callback =&gt; ajaxCall(json =&gt; callback(json));

<span class="hljs-comment">// Could change to...</span>
<span class="hljs-keyword">const</span> getServerStuff = callback =&gt; ajaxCall(callback);

<span class="hljs-comment">// Could change to...</span>
<span class="hljs-keyword">const</span> getServerStuff = ajaxCall;
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// A worst example...</span>
<span class="hljs-keyword">const</span> BlogController = {
  index(posts) { <span class="hljs-keyword">return</span> Views.index(posts); },
  show(post) { <span class="hljs-keyword">return</span> Views.show(post); },
  create(attrs) { <span class="hljs-keyword">return</span> DB.create(attrs); },
  update(post, attrs) { <span class="hljs-keyword">return</span> DB.update(post, attrs); },
  destroy(post) { <span class="hljs-keyword">return</span> DB.destroy(post); },
};

<span class="hljs-comment">// Could change to...</span>
<span class="hljs-keyword">const</span> BlogController = {
  index: Views.index,
  show: Views.show,
  create: DB.create,
  update: DB.update,
  destroy: DB.destroy,
};

<span class="hljs-comment">// Or remove it, it just binds Views and DB</span>
</code></pre>
<blockquote>
<p>&#x7528;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x628A;&#x53E6;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x5305;&#x8D77;&#x6765;&#xFF0C;&#x76EE;&#x7684;&#x4EC5;&#x4EC5;&#x662F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#xFF0C;&#x771F;&#x7684;&#x662F;&#x975E;&#x5E38;&#x7CDF;&#x7CD5;&#x7684;&#x7F16;&#x7A0B;&#x4E60;&#x60EF;&#x3002;&#xFF08;&#x8DDF;&#x53EF;&#x7EF4;&#x62A4;&#x6027;&#x5BC6;&#x5207;&#x76F8;&#x5173;&#xFF09;</p>
</blockquote>
<p><strong>&#x5982;&#x65E0;&#x5FC5;&#x8981;&#xFF0C;&#x52FF;&#x589E;&#x5B9E;&#x4F53;</strong></p>
<h2 id="3-&#x7EAF;&#x51FD;&#x6570;&#x7684;&#x597D;&#x5904;">3) &#x7EAF;&#x51FD;&#x6570;&#x7684;&#x597D;&#x5904;</h2>
<p>&#x7EAF;&#x51FD;&#x6570;&#x662F;&#x8FD9;&#x6837;&#x4E00;&#x79CD;&#x51FD;&#x6570;&#xFF0C;&#x5373;&#x76F8;&#x540C;&#x7684;&#x8F93;&#x5165;&#xFF0C;&#x6C38;&#x8FDC;&#x4F1A;&#x5F97;&#x5230;&#x76F8;&#x540C;&#x7684;&#x8F93;&#x51FA;&#xFF0C;&#x800C;&#x4E14;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x53EF;&#x89C2;&#x5BDF;&#x7684;&#x526F;&#x4F5C;&#x7528;&#x3002;</p>
<p>&#x4E0D;&#x7EAF;&#x7684;&#x51FD;&#x6570;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x53D6;&#x51B3;&#x4E8E; system state&#xFF0C;&#x5F15;&#x5165;&#x4E86;&#x5916;&#x90E8;&#x73AF;&#x5883;&#xFF0C;&#x589E;&#x52A0;&#x4E86; cognitive load&#x3002;&#x8FD9;&#x79CD;&#x4F9D;&#x8D56;&#x72B6;&#x6001;&#x662F;&#x5F71;&#x54CD;&#x7CFB;&#x7EDF;&#x590D;&#x6742;&#x5EA6;&#x7684;&#x7F6A;&#x9B41;&#x7978;&#x9996;&#x3002;&#x8F93;&#x5165;&#x4E4B;&#x5916;&#x7684;&#x56E0;&#x7D20;&#x80FD;&#x591F;&#x5DE6;&#x53F3;&#x7ED3;&#x679C;&#xFF0C;&#x4E0D;&#x4EC5;&#x8BA9;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x53D8;&#x5F97;&#x4E0D;&#x7EAF;&#xFF0C;&#x800C;&#x4E14;&#x5BFC;&#x81F4;&#x6BCF;&#x6B21;&#x6211;&#x4EEC;&#x601D;&#x8003;&#x6574;&#x4E2A;&#x8F6F;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#x90FD;&#x75DB;&#x82E6;&#x4E0D;&#x582A;&#x3002;</p>
<p>&#x7EAF;&#x51FD;&#x6570;&#x80FD;&#x591F;&#x81EA;&#x7ED9;&#x81EA;&#x8DB3;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8BA9;&#x5916;&#x90E8;&#x56E0;&#x7D20;&#x53D8;&#x6210; immutable &#x72B6;&#x6001;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x4FDD;&#x7559;&#x7EAF;&#x7CB9;&#x6027;&#x3002;</p>
<p>&#x4F5C;&#x7528;&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x4E00;&#x5207;&#x9664;&#x7ED3;&#x679C;&#x8BA1;&#x7B97;&#x4E4B;&#x5916;&#x53D1;&#x751F;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x4F5C;&#x7528;&#x672C;&#x8EAB;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x574F;&#x5904;&#xFF0C;&#x526F;&#x4F5C;&#x7528;&#x7684;&#x5173;&#x952E;&#x90E8;&#x5206;&#x5728;&#x4E8E;&#x201C;&#x526F;&#x201D;&#xFF0C;&#x662F;&#x6ECB;&#x751F; bug &#x7684;&#x6E29;&#x5E8A;&#x3002;</p>
<p>&#x53EA;&#x8981;&#x662F;&#x8DDF;&#x51FD;&#x6570;&#x5916;&#x90E8;&#x73AF;&#x5883;&#x53D1;&#x751F;&#x7684;&#x4EA4;&#x4E92;&#x5C31;&#x90FD;&#x662F;&#x526F;&#x4F5C;&#x7528;&#x2014;&#x2014;&#x8FD9;&#x4E00;&#x70B9;&#x53EF;&#x80FD;&#x4F1A;&#x8BA9;&#x4F60;&#x6000;&#x7591;&#x65E0;&#x526F;&#x4F5C;&#x7528;&#x7F16;&#x7A0B;&#x7684;&#x53EF;&#x884C;&#x6027;&#x3002;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x7684;&#x54F2;&#x5B66;&#x5C31;&#x662F;<strong>&#x5047;&#x5B9A;&#x526F;&#x4F5C;&#x7528;&#x662F;&#x9020;&#x6210;&#x4E0D;&#x6B63;&#x5F53;&#x884C;&#x4E3A;&#x7684;&#x4E3B;&#x8981;&#x539F;&#x56E0;</strong>&#x3002;</p>
<p>&#x8FD9;&#x5E76;&#x4E0D;&#x662F;&#x8BF4;&#xFF0C;&#x8981;&#x7981;&#x6B62;&#x4F7F;&#x7528;&#x4E00;&#x5207;&#x526F;&#x4F5C;&#x7528;&#xFF0C;&#x800C;&#x662F;&#x8BF4;&#xFF0C;&#x8981;&#x8BA9;&#x5B83;&#x4EEC;&#x5728;&#x53EF;&#x63A7;&#x7684;&#x8303;&#x56F4;&#x5185;&#x53D1;&#x751F;&#x3002;</p>
<p>&#x526F;&#x4F5C;&#x7528;&#x8BA9;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x53D8;&#x5F97;&#x4E0D;&#x7EAF;&#x662F;&#x6709;&#x9053;&#x7406;&#x7684;&#xFF1A;&#x4ECE;&#x5B9A;&#x4E49;&#x4E0A;&#x6765;&#x8BF4;&#xFF0C;&#x7EAF;&#x51FD;&#x6570;&#x5FC5;&#x987B;&#x8981;&#x80FD;&#x591F;&#x6839;&#x636E;&#x76F8;&#x540C;&#x7684;&#x8F93;&#x5165;&#x8FD4;&#x56DE;&#x76F8;&#x540C;&#x7684;&#x8F93;&#x51FA;&#xFF1B;&#x5982;&#x679C;&#x51FD;&#x6570;&#x9700;&#x8981;&#x8DDF;&#x5916;&#x90E8;&#x4E8B;&#x7269;&#x6253;&#x4EA4;&#x9053;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x8FD9;&#x4E00;&#x70B9;&#x4E86;&#x3002;</p>
<hr>
<p>&#x7EAF;&#x51FD;&#x6570;&#x4F18;&#x70B9;:</p>
<ul>
<li>&#x53EF;&#x7F13;&#x5B58;&#x6027; Cacheable<ul>
<li>&#x56FA;&#x5B9A;&#x8F93;&#x5165;&#x5BF9;&#x5E94;&#x56FA;&#x5B9A;&#x8F93;&#x51FA;&#xFF0C;&#x6240;&#x4EE5;&#x5929;&#x7136;&#x53EF;&#x7F13;&#x5B58;</li>
</ul>
</li>
<li>&#x53EF;&#x79FB;&#x690D;&#x6027;/&#x81EA;&#x6587;&#x6863;&#x5316; Portable/Self-Documenting<ul>
<li>&#x81EA;&#x7ED9;&#x81EA;&#x8DB3;</li>
<li>&#x901A;&#x8FC7;&#x5F3A;&#x8FEB;&#x6CE8;&#x5165;&#x4F9D;&#x8D56;&#xFF0C;&#x6216;&#x8005;&#x628A;&#x4F9D;&#x8D56;&#x5F53;&#x4F5C;&#x53C2;&#x6570;&#x6765;&#x4F20;&#x9012;&#xFF0C;&#x8FBE;&#x6210;&#x4E0E;&#x73AF;&#x5883;&#x65E0;&#x5173;</li>
</ul>
</li>
<li>&#x53EF;&#x6D4B;&#x8BD5;&#x6027; Testable<ul>
<li>&#x56FA;&#x5B9A;&#x8F93;&#x5165;&#x5BF9;&#x5E94;&#x56FA;&#x5B9A;&#x8F93;&#x51FA;</li>
<li>Quickcheck</li>
</ul>
</li>
<li>&#x5408;&#x7406;&#x6027; Reasonable<ul>
<li>&#x56FA;&#x5B9A;&#x8F93;&#x5165;&#x5BF9;&#x5E94;&#x56FA;&#x5B9A;&#x8F93;&#x51FA;</li>
<li>&#x5F15;&#x7528;&#x900F;&#x660E;&#x6027;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x66FF;&#x6362;&#x6210;&#x5B83;&#x6267;&#x884C;&#x6240;&#x5F97;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x800C;&#x4E14;&#x662F;&#x5728;&#x4E0D;&#x6539;&#x53D8;&#x6574;&#x4E2A;&#x7A0B;&#x5E8F;&#x884C;&#x4E3A;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x66FF;&#x6362;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x5C31;&#x8BF4;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x662F;&#x5F15;&#x7528;&#x900F;&#x660E;&#x7684;</li>
<li>&#x7B49;&#x5F0F;&#x63A8;&#x5BFC;</li>
</ul>
</li>
<li>&#x5E76;&#x884C;&#x4EE3;&#x7801;<ul>
<li>&#x7EAF;&#x51FD;&#x6570;&#x4E0D;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#xFF0C;&#x6240;&#x4EE5;&#x4E5F;&#x4E0D;&#x4F1A;&#x56E0;&#x526F;&#x4F5C;&#x7528;&#x8FDB;&#x5165;&#x7ADE;&#x4E89;&#x6001; race condition</li>
</ul>
</li>
</ul>
<hr>
<blockquote>
<p>I think the lack of reusability comes in object-oriented languages, not functional languages. Because the problem with object-oriented languages is they&#x2019;ve got all this implicit environment that they carry around with them. You wanted a banana but what you got was a gorilla holding the banana and the entire jungle.
If you have referentially transparent code, if you have pure functions &#x2014; all the data comes in its input arguments and everything goes out and leave no state behind &#x2014; it&#x2019;s incredibly reusable.
-- Joe Armstrong, creator of Erlang, on software reusability.</p>
</blockquote>
<h2 id="4-curry">4) Curry</h2>
<p><strong>&#x53EA;&#x4F20;&#x9012;&#x51FD;&#x6570;&#x4E00;&#x90E8;&#x5206;&#x6765;&#x8C03;&#x7528;&#x5B83;&#xFF0C;&#x8BA9;&#x5B83;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x53BB;&#x5904;&#x7406;&#x5269;&#x4E0B;&#x7684;&#x53C2;&#x6570;</strong></p>
<p><code>HOF</code>: Higher Order Functions &#x9AD8;&#x9636;&#x51FD;&#x6570;&#xFF0C;&#x53C2;&#x6570;&#x6216;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;&#x51FD;&#x6570;&#x7684;&#x51FD;&#x6570;</p>
<p>&#x7B56;&#x7565;&#x6027;&#x7684;&#x628A;&#x8981;&#x64CD;&#x4F5C;&#x7684;&#x6570;&#x636E;&#x653E;&#x5230;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x6709;&#x5229;&#x4E8E; curry&#x3002;</p>
<p>&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x5730;&#x4F20;&#x9012;&#x51E0;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5C31;&#x80FD;&#x52A8;&#x6001;&#x521B;&#x5EFA;&#x5B9E;&#x7528;&#x7684;&#x65B0;&#x51FD;&#x6570;&#xFF1B;&#x800C;&#x4E14;&#x8FD8;&#x80FD;&#x5E26;&#x6765;&#x4E00;&#x4E2A;&#x989D;&#x5916;&#x597D;&#x5904;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x4FDD;&#x7559;&#x4E86;&#x6570;&#x5B66;&#x7684;&#x51FD;&#x6570;&#x5B9A;&#x4E49;&#xFF0C;&#x5C3D;&#x7BA1;&#x53C2;&#x6570;&#x4E0D;&#x6B62;&#x4E00;&#x4E2A;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> add = x =&gt; y =&gt; x + y;

<span class="hljs-keyword">const</span> add1 = add(<span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> add10 = add(<span class="hljs-number">10</span>);

add1(<span class="hljs-number">2</span>);
<span class="hljs-comment">// 3</span>

add10(<span class="hljs-number">5</span>);
<span class="hljs-comment">// 15</span>
</code></pre>
<hr>
<p><code>ramda.curry</code> return a curried equivalent of provided function. The curried function has two unusual capabilities. First, its arguments needn&apos;t be provided one at a time. If <code>f</code> is a ternary function and <code>g</code> is <code>R.curry(f)</code>, the following are equivalent:</p>
<pre><code>- g(1)(2)(3)
- g(1)(2, 3)
- g(1, 2)(3)
- g(1, 2, 3)
</code></pre><p>Secondly, the special placeholder value <code>R.__</code> may be used to specify &quot;gaps&quot;, allowing partial application of any combination of arguments, regardless of their positions. if <code>g</code> is as above and <code>_</code> is <code>R.__</code>, th folloing are equivalent:</p>
<pre><code>- g(1, 2, 3)
- g(_, 2, 3)(1)
- g(_, _, 3)(1)(2)
- g(_, _, 3)(1, 2)
- g(_, 2)(1)(3)
- g(_, 2)(1, 3)
- g(_, 2)(_, 3)(1)
</code></pre><h2 id="5-compose">5) Compose</h2>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> toUpperCase = x =&gt; x.toUpperCase();
<span class="hljs-keyword">const</span> exclaim = x =&gt; <span class="hljs-string">`<span class="hljs-subst">${x}</span>!`</span>;

<span class="hljs-comment">// With Compose</span>
<span class="hljs-keyword">const</span> shout = compose(exclaim, toUpperCase);

<span class="hljs-comment">// No Compose</span>
<span class="hljs-keyword">const</span> shoutNormal = x =&gt; exclaim(toUpperCase(x));

shout(<span class="hljs-string">&apos;hello world&apos;</span>);
shoutNormal(<span class="hljs-string">&apos;hello world&apos;</span>);
<span class="hljs-comment">// =&gt; &quot;HELLO WORLD!&quot;</span>
</code></pre>
<p>&#x8BA9;&#x4EE3;&#x7801;&#x4ECE;&#x53F3;&#x5411;&#x5DE6;&#x6267;&#x884C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x7531;&#x5185;&#x800C;&#x5916;&#x6267;&#x884C;&#x3002;&#x4ECE;&#x53F3;&#x5411;&#x5DE6;&#x66F4;&#x52A0;&#x80FD;&#x591F;&#x53CD;&#x6620;&#x6570;&#x5B66;&#x4E0A;&#x7684;&#x542B;&#x4E49;&#xFF0C;&#x56E0;&#x4E3A;&#x7EC4;&#x5408;&#x7684;&#x6982;&#x5FF5;&#x76F4;&#x63A5;&#x6765;&#x6E90;&#x4E8E;&#x6570;&#x5B66;&#x3002;</p>
<p><strong>&#x7ED3;&#x5408;&#x5F8B;</strong></p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> f1 = compose(f, compose(g, h));
<span class="hljs-keyword">const</span> f2 = compose(compose(f, g), h);
<span class="hljs-keyword">const</span> f3 = compose(f, g, h);

f1 == f2 &amp;&amp; f1 == f3 &amp;&amp; f2 == f3;
<span class="hljs-comment">// =&gt; true</span>
</code></pre>
<p>&#x5982;&#x4F55;&#x4E3A; <code>compose</code> &#x7684;&#x8C03;&#x7528;&#x5206;&#x7EC4;&#x4E0D;&#x91CD;&#x8981;&#xFF0C;&#x56E0;&#x4E3A;&#x7ED3;&#x679C;&#x4E00;&#x6837;&#x3002;&#x5BF9;&#x4E8E;&#x591A;&#x4E2A;&#x7EC4;&#x5408;&#xFF0C;&#x65E2;&#x7136;&#x7B26;&#x5408;&#x7ED3;&#x5408;&#x5F8B;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x53EA;&#x5199;&#x4E00;&#x4E2A;&#x7EC4;&#x5408;&#xFF0C;&#x60F3;&#x4F20;&#x7ED9;&#x5B83;&#x591A;&#x5C11;&#x4E2A;&#x51FD;&#x6570;&#x5C31;&#x4F20;&#x591A;&#x5C11;&#xFF0C;&#x7531;&#x5B83;&#x81EA;&#x5DF1;&#x51B3;&#x5B9A;&#x5206;&#x7EC4;&#x3002;</p>
<p>&#x5982;&#x4F55;&#x7EC4;&#x5408;&#x6CA1;&#x6709;&#x6807;&#x51C6;&#x7B54;&#x6848;&#xFF0C;&#x901A;&#x5E38;&#x6700;&#x4F73;&#x5B9E;&#x8DF5;&#x662F;&#x8BA9;&#x7EC4;&#x5408;&#x53EF;&#x91CD;&#x7528;&#x3002;</p>
<p><strong>pointfree</strong></p>
<p>&#x51FD;&#x6570;&#x65E0;&#x987B;&#x63D0;&#x53CA;&#x5C06;&#x8981;&#x64CD;&#x4F5C;&#x7684;&#x6570;&#x636E;&#x662F;&#x4EC0;&#x4E48;&#x6837;&#x7684;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// non-pointfree</span>
<span class="hljs-keyword">const</span> snakeCase = word =&gt; word.toLowerCase().replace(<span class="hljs-regexp">/\s+/ig</span>, <span class="hljs-string">&apos;_&apos;</span>);

<span class="hljs-comment">// pointfree</span>
<span class="hljs-keyword">const</span> replace = curry((reg, replacement, str) =&gt; str.replace(reg, replacement));
<span class="hljs-keyword">const</span> toLowerCase = curry(str =&gt; str.toLowerCase());
<span class="hljs-keyword">const</span> snakeCasePF = compose(replace(<span class="hljs-regexp">/\s+/ig</span>, <span class="hljs-string">&apos;_&apos;</span>), toLowerCase);
</code></pre>
<p><strong>debug</strong></p>
<p>&#x7EC4;&#x5408;&#x7684;&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x9519;&#x8BEF;&#xFF0C;&#x5728;&#x6CA1;&#x6709;&#x5C40;&#x90E8;&#x8C03;&#x7528;&#x4E4B;&#x524D;&#xFF0C;&#x5C31;&#x7EC4;&#x5408;&#x7C7B;&#x4F3C; <code>map</code> &#x8FD9;&#x6837;&#x63A5;&#x53D7;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x51FD;&#x6570;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// &#x9519;&#x8BEF;&#x505A;&#x6CD5;&#xFF0C;&#x4F20;&#x7ED9;&#x4E86; angry &#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x4E0D;&#x77E5;&#x9053;&#x6700;&#x540E;&#x4F20;&#x7ED9; map &#x7684;&#x662F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;</span>
<span class="hljs-keyword">const</span> latin = compose(map, angry, reverse);
latin([<span class="hljs-string">&apos;frog&apos;</span>, <span class="hljs-string">&apos;eyes&apos;</span>]);
<span class="hljs-comment">// error</span>

<span class="hljs-comment">// &#x6B63;&#x786E;&#x505A;&#x6CD5;&#xFF1A;&#x6BCF;&#x4E2A;&#x51FD;&#x6570;&#x90FD;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x5B9E;&#x9645;&#x53C2;&#x6570;</span>
<span class="hljs-keyword">const</span> latin = compose(map(angry), reverse);
latin([<span class="hljs-string">&apos;frog&apos;</span>, <span class="hljs-string">&apos;eyes&apos;</span>]);
<span class="hljs-comment">// [&quot;EYES!&quot;, &quot;FROG!&quot;]</span>
</code></pre>
<p>&#x5982;&#x679C;&#x5728; debug &#x7EC4;&#x5408;&#x7684;&#x65F6;&#x5019;&#x9047;&#x5230;&#x4E86;&#x56F0;&#x96BE;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x4E0D;&#x7EAF;&#x7684; <code>trace</code> &#x51FD;&#x6570;&#x6765;&#x8FFD;&#x8E2A;&#x4EE3;&#x7801;&#x6267;&#x884C;&#x60C5;&#x51B5;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> trace = curry((tag, x) =&gt; {
  <span class="hljs-built_in">console</span>.log(tag, x);
  <span class="hljs-keyword">return</span> x;
});

<span class="hljs-comment">// &#x7528;&#x5728;&#x4E0A;&#x4F8B;&#x91CC;</span>
<span class="hljs-keyword">const</span> latin = compose(
  map,
  trace(<span class="hljs-string">&apos;after angry&apos;</span>),
  angry,
  trace(<span class="hljs-string">&apos;after reverse&apos;</span>),
  reverse,
);
</code></pre>
<h2 id="6-&#x793A;&#x4F8B;&#x5E94;&#x7528;">6) &#x793A;&#x4F8B;&#x5E94;&#x7528;</h2>
<p><strong>&#x58F0;&#x660E;&#x5F0F;&#x4EE3;&#x7801;</strong></p>
<p>&#x4E0D;&#x6307;&#x793A;&#x8BA1;&#x7B97;&#x673A;&#x5982;&#x4F55;&#x5DE5;&#x4F5C;&#xFF0C;&#x800C;&#x662F;&#x6307;&#x51FA;&#x6211;&#x4EEC;&#x660E;&#x786E;&#x5E0C;&#x671B;&#x5F97;&#x5230;&#x7684;&#x7ED3;&#x679C;&#x3002;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x58F0;&#x660E;&#x5F0F;&#x8981;&#x5199;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x7684;&#x6307;&#x793A;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// &#x547D;&#x4EE4;&#x5F0F;</span>
<span class="hljs-keyword">var</span> makes = [];
<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; cars.length; i++) {
  makes.push(cars[i].make);
}

<span class="hljs-comment">// &#x58F0;&#x660E;&#x5F0F;</span>
<span class="hljs-keyword">var</span> makes = cars.map(car =&gt; car.make);
</code></pre>
<p>&#x547D;&#x4EE4;&#x5F0F;&#x7684;&#x5FAA;&#x73AF;&#x8981;&#x6C42;&#x4F60;&#x5FC5;&#x987B;&#x5148;&#x5B9E;&#x4F8B;&#x5316;&#x4E00;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x800C;&#x4E14;&#x6267;&#x884C;&#x5B8C;&#x8FD9;&#x4E2A;&#x5B9E;&#x4F8B;&#x5316;&#x8BED;&#x53E5;&#x4E4B;&#x540E;&#xFF0C;&#x89E3;&#x91CA;&#x5668;&#x624D;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x540E;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x7136;&#x540E;&#x518D;&#x76F4;&#x63A5;&#x8FED;&#x4EE3; cars &#x5217;&#x8868;&#xFF0C;&#x624B;&#x52A8;&#x589E;&#x52A0;&#x8BA1;&#x6570;&#x5668;&#xFF0C;&#x628A;&#x5404;&#x79CD;&#x96F6;&#x96F6;&#x6563;&#x6563;&#x7684;&#x4E1C;&#x897F;&#x90FD;&#x5C55;&#x793A;&#x51FA;&#x6765;...&#x5B9E;&#x5728;&#x662F;&#x76F4;&#x767D;&#x5F97;&#x6709;&#x4E9B;&#x9732;&#x9AA8;&#x3002;</p>
<p>&#x4F7F;&#x7528; map &#x7684;&#x7248;&#x672C;&#x662F;&#x4E00;&#x4E2A;&#x8868;&#x8FBE;&#x5F0F;&#xFF0C;&#x5B83;&#x5BF9;&#x6267;&#x884C;&#x987A;&#x5E8F;&#x6CA1;&#x6709;&#x8981;&#x6C42;&#x3002;&#x800C;&#x4E14;&#xFF0C;map &#x51FD;&#x6570;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x8FED;&#x4EE3;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x7EC4;&#x5982;&#x4F55;&#x6536;&#x96C6;&#xFF0C;&#x90FD;&#x6709;&#x5F88;&#x5927;&#x7684;&#x81EA;&#x7531;&#x5EA6;&#x3002;&#x5B83;&#x6307;&#x660E;&#x7684;&#x662F;<strong>&#x505A;&#x4EC0;&#x4E48;</strong>&#xFF0C;&#x4E0D;&#x662F;<strong>&#x600E;&#x4E48;&#x505A;</strong>&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5B83;&#x662F;&#x6B63;&#x513F;&#x516B;&#x7ECF;&#x7684;&#x58F0;&#x660E;&#x5F0F;&#x4EE3;&#x7801;&#x3002;</p>
<p>&#x53E6;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// &#x547D;&#x4EE4;&#x5F0F;</span>
<span class="hljs-keyword">const</span> authenticate = form =&gt; {
  <span class="hljs-keyword">const</span> user = toUser(form);
  <span class="hljs-keyword">return</span> logIn(user);
};
<span class="hljs-comment">// &#x786C;&#x7F16;&#x7801;&#x4E86;&#x4E00;&#x6B65;&#x63A5;&#x4E00;&#x6B65;&#x7684;&#x6267;&#x884C;&#x65B9;&#x5F0F;</span>

<span class="hljs-comment">// &#x58F0;&#x660E;&#x5F0F;</span>
<span class="hljs-keyword">const</span> authenticate = compose(
  logIn,
  toUser,
);
<span class="hljs-comment">// &#x7528;&#x6237;&#x9A8C;&#x8BC1;&#x662F; toUser &#x548C; logIn &#x4E24;&#x4E2A;&#x884C;&#x4E3A;&#x7684;&#x7EC4;&#x5408;</span>
</code></pre>
<p><strong>TODO: how to compose Promise?</strong></p>
<h2 id="7-hindley-milner-&#x7C7B;&#x578B;&#x7B7E;&#x540D;">7) Hindley-Milner &#x7C7B;&#x578B;&#x7B7E;&#x540D;</h2>
<p><strong>&#x4E00;&#x4E9B;&#x4F8B;&#x5B50;&#xFF1A;</strong></p>
<pre><code class="lang-javascript"><span class="hljs-comment">// strLength :: String -&gt; Number</span>
<span class="hljs-keyword">const</span> strLength = s =&gt; s.length;

<span class="hljs-comment">// join :: String -&gt; [String] -&gt; String</span>
<span class="hljs-keyword">const</span> join = curry((what, xs) =&gt; xs.join(what));

<span class="hljs-comment">// match :: Regex -&gt; String -&gt; [String]</span>
<span class="hljs-keyword">const</span> match = curry((reg, s) =&gt; s.match(reg));

<span class="hljs-comment">// replace :: Regex -&gt; String -&gt; String -&gt; String</span>
<span class="hljs-keyword">const</span> replace = curry((reg, sub, s) =&gt; s.replace(reg, sub));

<span class="hljs-comment">// onHoliday :: String -&gt; [String]</span>
<span class="hljs-keyword">const</span> onHoliday = match(<span class="hljs-regexp">/holiday/ig</span>);

<span class="hljs-comment">// id :: a -&gt; a</span>
<span class="hljs-keyword">const</span> id = x =&gt; x;

<span class="hljs-comment">// map :: (a -&gt; b) -&gt; [a] -&gt; [b]</span>
<span class="hljs-keyword">const</span> map = curry((f, xs) =&gt; xs.map(f));

<span class="hljs-comment">// head :: [a] =&gt; a</span>
<span class="hljs-keyword">const</span> head = xs =&gt; xs[<span class="hljs-number">0</span>];

<span class="hljs-comment">// filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</span>
<span class="hljs-keyword">const</span> filter = curry((f, xs) =&gt; xs.filter(f));

<span class="hljs-comment">// reduce :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b</span>
<span class="hljs-keyword">const</span> reduce = curry((f, x, xs) =&gt; xs.reduce(f, x));
</code></pre>
<p><strong>&#x7F29;&#x5C0F;&#x53EF;&#x80FD;&#x6027;&#x8303;&#x56F4;</strong> (narrowing of possibility)</p>
<p><code>_parametricity_</code> &#x51FD;&#x6570;&#x5C06;&#x4F1A;&#x4EE5;&#x4E00;&#x79CD;&#x7EDF;&#x4E00;&#x7684;&#x884C;&#x4E3A;&#x4F5C;&#x7528;&#x4E8E;&#x6240;&#x6709;&#x7684;&#x7C7B;&#x578B;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// head :: [a] -&gt; a</span>
</code></pre>
<p>&#x6CE8;&#x610F;&#x770B; head &#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5B83;&#x63A5;&#x53D7; [a] &#x8FD4;&#x56DE; a&#x3002;&#x6211;&#x4EEC;&#x9664;&#x4E86;&#x77E5;&#x9053;&#x53C2;&#x6570;&#x662F;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x4E00;&#x6982;&#x4E0D;&#x77E5;&#xFF1B;&#x6240;&#x4EE5;&#x51FD;&#x6570;&#x7684;&#x529F;&#x80FD;&#x5C31;&#x53EA;&#x9650;&#x4E8E;&#x64CD;&#x4F5C;&#x8FD9;&#x4E2A;&#x6570;&#x7EC4;&#x4E0A;&#x3002;&#x5728;&#x5B83;&#x5BF9; a &#x4E00;&#x65E0;&#x6240;&#x77E5;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x5BF9; a &#x505A;&#x4EC0;&#x4E48;&#x64CD;&#x4F5C;&#x5462;&#xFF1F;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;a &#x544A;&#x8BC9;&#x6211;&#x4EEC;&#x5B83;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5B83;&#x53EF;&#x4EE5;&#x662F;&#x4EFB;&#x610F;&#x7C7B;&#x578B;&#xFF1B;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x7684;&#x51FD;&#x6570;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A;&#x53EF;&#x80FD;&#x7684;&#x7C7B;&#x578B;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x5FC5;&#x987B;&#x4FDD;&#x6301;&#x7EDF;&#x4E00;&#x3002;&#x8FD9;&#x5C31;&#x662F; <code>_parametricity_</code> &#x7684;&#x542B;&#x4E49;&#x3002;&#x8981;&#x8BA9;&#x6211;&#x4EEC;&#x6765;&#x731C;&#x6D4B; head &#x7684;&#x5B9E;&#x73B0;&#x7684;&#x8BDD;&#xFF0C;&#x552F;&#x4E00;&#x5408;&#x7406;&#x7684;&#x63A8;&#x65AD;&#x5C31;&#x662F;&#x5B83;&#x8FD4;&#x56DE;&#x6570;&#x7EC4;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#xFF0C;&#x6216;&#x8005;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#xFF0C;&#x6216;&#x8005;&#x67D0;&#x4E2A;&#x968F;&#x673A;&#x7684;&#x5143;&#x7D20;&#xFF1B;&#x5F53;&#x7136;&#xFF0C;head &#x8FD9;&#x4E2A;&#x547D;&#x540D;&#x5E94;&#x8BE5;&#x80FD;&#x7ED9;&#x6211;&#x4EEC;&#x4E00;&#x4E9B;&#x7EBF;&#x7D22;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// reverse :: [a] -&gt; [a]</span>
</code></pre>
<p>&#x4EC5;&#x4ECE;&#x7C7B;&#x578B;&#x7B7E;&#x540D;&#x6765;&#x770B;&#xFF0C;reverse &#x53EF;&#x80FD;&#x7684;&#x76EE;&#x7684;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x518D;&#x6B21;&#x5F3A;&#x8C03;&#xFF0C;&#x5B83;&#x4E0D;&#x80FD;&#x5BF9; a &#x505A;&#x4EFB;&#x4F55;&#x7279;&#x5B9A;&#x7684;&#x4E8B;&#x60C5;&#x3002;&#x5B83;&#x4E0D;&#x80FD;&#x628A; a &#x53D8;&#x6210;&#x53E6;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#xFF0C;&#x6216;&#x8005;&#x5F15;&#x5165;&#x4E00;&#x4E2A; b&#xFF1B;&#x8FD9;&#x90FD;&#x662F;&#x4E0D;&#x53EF;&#x80FD;&#x7684;&#x3002;&#x90A3;&#x5B83;&#x53EF;&#x4EE5;&#x6392;&#x5E8F;&#x4E48;&#xFF1F;&#x7B54;&#x6848;&#x662F;&#x4E0D;&#x80FD;&#xFF0C;&#x6CA1;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x4FE1;&#x606F;&#x8BA9;&#x5B83;&#x53BB;&#x4E3A;&#x6BCF;&#x4E00;&#x4E2A;&#x53EF;&#x80FD;&#x7684;&#x7C7B;&#x578B;&#x6392;&#x5E8F;&#x3002;&#x5B83;&#x80FD;&#x91CD;&#x65B0;&#x6392;&#x5217;&#x4E48;&#xFF1F;&#x53EF;&#x4EE5;&#x7684;&#xFF0C;&#x6211;&#x89C9;&#x5F97;&#x5B83;&#x53EF;&#x4EE5;&#xFF0C;&#x4F46;&#x5B83;&#x5FC5;&#x987B;&#x4EE5;&#x4E00;&#x79CD;&#x53EF;&#x9884;&#x6599;&#x7684;&#x65B9;&#x5F0F;&#x8FBE;&#x6210;&#x76EE;&#x6807;&#x3002;&#x53E6;&#x5916;&#xFF0C;&#x5B83;&#x4E5F;&#x6709;&#x53EF;&#x80FD;&#x5220;&#x9664;&#x6216;&#x8005;&#x91CD;&#x590D;&#x67D0;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x3002;&#x91CD;&#x70B9;&#x662F;&#xFF0C;&#x4E0D;&#x7BA1;&#x5728;&#x54EA;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7C7B;&#x578B; a &#x7684;&#x591A;&#x6001;&#x6027;&#xFF08;polymorphism&#xFF09;&#x90FD;&#x4F1A;&#x5927;&#x5E45;&#x7F29;&#x5C0F; reverse &#x51FD;&#x6570;&#x53EF;&#x80FD;&#x7684;&#x884C;&#x4E3A;&#x7684;&#x8303;&#x56F4;&#x3002;</p>
<p><strong>&#x81EA;&#x7531;&#x5B9A;&#x7406;</strong> (free theorems)</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// head :: [a] -&gt; a</span>
compose(f, head) == compose(head, map(f));

<span class="hljs-comment">// filter :: (a -&gt; Bool) -&gt; [a] -&gt; [a]</span>
compose(map(f), filter(compose(p, f))) == compose(filter(p), map(f));
</code></pre>
<p><strong>&#x7C7B;&#x578B;&#x7EA6;&#x675F;</strong> (type constraints)</p>
<p>&#x7B7E;&#x540D;&#x53EF;&#x4EE5;&#x628A;&#x7C7B;&#x578B;&#x7EA6;&#x675F;&#x4E3A;&#x4E00;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x63A5;&#x53E3; interface</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// sort :: Ord a =&gt; [a] -&gt; [a]</span>
</code></pre>
<p>&#x80D6;&#x7BAD;&#x5934;&#x5DE6;&#x8FB9;&#x8868;&#x660E; a &#x4E00;&#x5B9A;&#x662F;&#x4E2A; Ord &#x5BF9;&#x8C61;&#x3002;Ord &#x5230;&#x5E95;&#x662F;&#x4EC0;&#x4E48;&#xFF1F;&#x5B83;&#x662F;&#x4ECE;&#x54EA;&#x6765;&#x7684;&#xFF1F;&#x5728;&#x4E00;&#x95E8;&#x5F3A;&#x7C7B;&#x578B;&#x8BED;&#x8A00;&#x4E2D;&#xFF0C;&#x5B83;&#x53EF;&#x80FD;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x80FD;&#x591F;&#x8BA9;&#x4E0D;&#x540C;&#x7684;&#x503C;&#x6392;&#x5E8F;&#x3002;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x4EC5;&#x80FD;&#x591F;&#x83B7;&#x53D6;&#x5173;&#x4E8E; a &#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x4E86;&#x89E3; sort &#x51FD;&#x6570;&#x5177;&#x4F53;&#x8981;&#x5E72;&#x4EC0;&#x4E48;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x80FD;&#x9650;&#x5236;&#x51FD;&#x6570;&#x7684;&#x4F5C;&#x7528;&#x8303;&#x56F4;&#x3002;&#x6211;&#x4EEC;&#x628A;&#x8FD9;&#x79CD;&#x63A5;&#x53E3;&#x58F0;&#x660E;&#x53EB;&#x505A;&#x7C7B;&#x578B;&#x7EA6;&#x675F;&#xFF08;type constraints&#xFF09;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// assertEqual :: (Eq a, Show a) =&gt; a -&gt; a -&gt; Assertion</span>
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x6709;&#x4E24;&#x4E2A;&#x7EA6;&#x675F;&#xFF1A;Eq &#x548C; Show&#x3002;&#x5B83;&#x4EEC;&#x4FDD;&#x8BC1;&#x4E86;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x68C0;&#x67E5;&#x4E0D;&#x540C;&#x7684; a &#x662F;&#x5426;&#x76F8;&#x7B49;&#xFF0C;&#x5E76;&#x5728;&#x6709;&#x4E0D;&#x76F8;&#x7B49;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x6253;&#x5370;&#x51FA;&#x5176;&#x4E2D;&#x7684;&#x5DEE;&#x5F02;&#x3002;</p>
<h2 id="8-tupperware">8) Tupperware</h2>
<p><strong>Container <em>(Identity / id)</em></strong></p>
<p>&#x51FD;&#x6570;&#x5F0F;&#x7A0B;&#x5E8F;&#x5373;&#x901A;&#x8FC7;&#x7BA1;&#x9053;&#x628A;&#x6570;&#x636E;&#x5728;&#x4E00;&#x7CFB;&#x5217;&#x7EAF;&#x51FD;&#x6570;&#x95F4;&#x4F20;&#x9012;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x8FD9;&#x4E9B;&#x7A0B;&#x5E8F;&#x5C31;&#x662F;&#x58F0;&#x660E;&#x5F0F;&#x7684;&#x884C;&#x4E3A;&#x89C4;&#x8303;&#x3002;&#x4F46;&#x5982;&#x4F55;&#x5904;&#x7406;&#x63A7;&#x5236;&#x6D41; <code>_control flow_</code>&#x3001;&#x5F02;&#x5E38;&#x5904;&#x7406; <code>_error handling_</code>&#x3001;&#x5F02;&#x6B65;&#x64CD;&#x4F5C; <code>_asynchronous actions_</code> &#x548C;&#x72B6;&#x6001; <code>_state_</code> &#x5462;&#xFF1F;&#x8FD8;&#x6709;&#x66F4;&#x68D8;&#x624B;&#x7684;&#x4F5C;&#x7528; <code>_effects_</code>&#xFF1F;</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x5B58;&#x653E;&#x4EFB;&#x610F;&#x7C7B;&#x578B;&#x503C;&#x7684;&#x5BB9;&#x5668;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> Container = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) </span>{
  <span class="hljs-keyword">this</span>.__value = x;
}

Container.of = x =&gt; <span class="hljs-keyword">new</span> Container(x);
</code></pre>
<ul>
<li>Container &#x662F;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; __value &#x5C5E;&#x6027;&#x7684;&#x5BF9;&#x8C61;</li>
<li>__value &#x4E0D;&#x80FD;&#x662F;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;&#x7684;&#x7C7B;&#x578B;</li>
<li>&#x6570;&#x636E;&#x4E00;&#x65E6;&#x5B58;&#x653E;&#x5230; Container&#xFF0C;&#x5C31;&#x4F1A;&#x4E00;&#x76F4;&#x5F85;&#x5728;&#x90A3;&#x513F;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7528; .__value &#x83B7;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x8FD9;&#x6837;&#x6709;&#x6096;&#x4E8E;&#x521D;&#x8877;</li>
</ul>
<hr>
<p><strong>Functor <em>(mappable container)</em></strong></p>
<p>&#x7136;&#x540E;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x64CD;&#x4F5C;&#x5BB9;&#x5668;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// (a -&gt; b) -&gt; Container a -&gt; Container b</span>
Container.prototype.map = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) </span>{
  <span class="hljs-keyword">return</span> Container.of(f(<span class="hljs-keyword">this</span>.__value));
}
</code></pre>
<p>&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x80FD;&#x591F;&#x8BA9;&#x6211;&#x4EEC;&#x5728;&#x4E0D;&#x79BB;&#x5F00; Container &#x7684;&#x72B6;&#x6001;&#x4E0B;&#x64CD;&#x4F5C;&#x5BB9;&#x5668;&#x91CC;&#x9762;&#x7684;&#x503C;&#x3002;Container &#x91CC;&#x7684;&#x503C;&#x4F20;&#x9012;&#x7ED9; map &#x51FD;&#x6570;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4EFB;&#x6211;&#x4EEC;&#x64CD;&#x4F5C;&#xFF1B;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x610F;&#x5916;&#x518D;&#x628A;&#x5B83;&#x653E;&#x56DE;&#x5B83;&#x6240;&#x5C5E;&#x7684; Container&#x3002;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x7ED3;&#x679C;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x80FD;&#x8FDE;&#x7EED;&#x8C03;&#x7528; map&#xFF0C;&#x8FD0;&#x884C;&#x4EFB;&#x4F55;&#x6211;&#x4EEC;&#x60F3;&#x8FD0;&#x884C;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x751A;&#x81F3;&#x8FD8;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x503C;&#x7684;&#x7C7B;&#x578B;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// &#x8FDE;&#x7EED;&#x8C03;&#x7528; map</span>
Container.of(<span class="hljs-string">&apos;bombs&apos;</span>).map(concat(<span class="hljs-string">&apos; away&apos;</span>)).map(_.prop(<span class="hljs-string">&apos;length&apos;</span>));
<span class="hljs-comment">// =&gt; Container(10)</span>
</code></pre>
<p>&#x6362;&#x4E2A;&#x89D2;&#x5EA6;&#x601D;&#x8003;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x4E00;&#x76F4;&#x8C03;&#x7528; map&#xFF0C;&#x90A3;&#x5B83;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x4E00;&#x4E2A; composition&#x3002;&#x8FD9;&#x5F15;&#x7533;&#x51FA; functor &#x7684;&#x5B9A;&#x4E49;&#xFF1A;</p>
<p><strong>functor &#x662F;&#x5B9E;&#x73B0;&#x4E86; map &#x51FD;&#x6570;&#x5E76;&#x9075;&#x5B88;&#x4E00;&#x4E9B;&#x7279;&#x5B9A;&#x89C4;&#x5219;&#x7684;&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#x3002;</strong></p>
<p>&#x628A;&#x503C;&#x653E;&#x8FDB;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x800C;&#x4E14;&#x53EA;&#x80FD;&#x4F7F;&#x7528; map &#x6765;&#x5904;&#x7406;&#x5B83;&#x3002;&#x5F53; map &#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x8BF7;&#x6C42;&#x5BB9;&#x5668;&#x6765;&#x8FD0;&#x884C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x5BF9;&#x4E8E;<strong>&#x51FD;&#x6570;&#x8FD0;&#x7528;&#x7684;&#x62BD;&#x8C61;</strong>&#x3002;</p>
<hr>
<p><strong>Maybe <em>(one kind of functors)</em> &#x7A7A;&#x503C;&#x68C0;&#x67E5;</strong></p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x4E00;&#x4E2A; Maybe&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> Maybe = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) </span>{
  <span class="hljs-keyword">this</span>.__value = x;
}

Maybe.of = x =&gt; <span class="hljs-keyword">new</span> Maybe(x);

Maybe.prototype.isNothing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.__value === <span class="hljs-literal">null</span> || <span class="hljs-keyword">this</span>.__value === <span class="hljs-literal">undefined</span>);
}

Maybe.prototype.map = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.isNothing() ? Maybe.of(<span class="hljs-literal">null</span>) : Maybe.of(f(<span class="hljs-keyword">this</span>.__value));
}
</code></pre>
<p>&#x7136;&#x540E;&#x5C31;&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x8C03;&#x7528;&#xFF1A;</p>
<pre><code class="lang-javascript">Maybe.of(<span class="hljs-string">&apos;Malkovich Malkovich&apos;</span>).map(match(<span class="hljs-regexp">/a/ig</span>));
<span class="hljs-comment">// =&gt; Maybe([&apos;a&apos;, &apos;a&apos;])</span>

Maybe.of(<span class="hljs-literal">null</span>).map(match(<span class="hljs-regexp">/a/ig</span>));
<span class="hljs-comment">// =&gt; Maybe(null)</span>

Maybe.of({ name: <span class="hljs-string">&apos;Boris&apos;</span> }).map(prop(<span class="hljs-string">&apos;age&apos;</span>)).map(add(<span class="hljs-number">10</span>));
<span class="hljs-comment">// =&gt; Maybe(null)</span>

Maybe.of({ name: <span class="hljs-string">&apos;Dinah&apos;</span>, age: <span class="hljs-number">14</span> }).map(prop(<span class="hljs-string">&apos;age&apos;</span>)).map(add(<span class="hljs-number">10</span>));
<span class="hljs-comment">// =&gt; Maybe(24)</span>
</code></pre>
<p>Maybe &#x4F1A;&#x5148;&#x68C0;&#x67E5;&#x81EA;&#x5DF1;&#x7684;&#x989D;&#x503C;&#x662F;&#x5426;&#x4E3A;&#x7A7A;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x8C03;&#x7528;&#x4F20;&#x8FDB;&#x6765;&#x7684;&#x51FD;&#x6570;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5728;&#x4F7F;&#x7528; map &#x7684;&#x65F6;&#x5019;&#x5C31;&#x80FD;&#x907F;&#x514D;&#x9EBB;&#x70E6;&#x7684;&#x7A7A;&#x503C;&#x4E86;&#x3002;</p>
<p>&#x4E0A;&#x9762;&#x8C03;&#x7528;&#x7684;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x70B9;&#x8BB0;&#x6CD5; <em>(dot notation syntax)</em> &#x5DF2;&#x7ECF;&#x8DB3;&#x591F;&#x51FD;&#x6570;&#x5F0F;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x8981;&#x8FFD;&#x6C42; piontfree&#xFF0C;map &#x53EF;&#x4EE5;&#x7528; curry &#x51FD;&#x6570;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x4EE3;&#x7406;&#x4EFB;&#x4F55; functor&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// map :: Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b</span>
<span class="hljs-keyword">const</span> map = curry(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f, any_functor_at_all</span>) </span>{
  <span class="hljs-keyword">return</span> any_functor_at_all.map(f);
});
</code></pre>
<p>Maybe &#x6700;&#x5E38;&#x7528;&#x4E8E;&#x53EF;&#x80FD;&#x4F1A;&#x65E0;&#x6CD5;&#x6210;&#x529F;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x7684;&#x51FD;&#x6570;&#x4E2D;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// safeHead :: [a] -&gt; Maybe(a)</span>
<span class="hljs-keyword">const</span> safeHead = xs =&gt; Maybe.of(xs[<span class="hljs-number">0</span>]);

<span class="hljs-keyword">const</span> streetName = compose(
  map(prop(<span class="hljs-string">&apos;street&apos;</span>)),
  safeHead,
  prop(<span class="hljs-string">&apos;addresses&apos;</span>),
);

streetName({ addresses: [] });
<span class="hljs-comment">// =&gt; Maybe(null)</span>

streetName({ addresses: [ { street: <span class="hljs-string">&apos;Shady Ln.&apos;</span>, number: <span class="hljs-number">4201</span> } ] });
<span class="hljs-comment">// =&gt; Maybe(&apos;Shady Ln.&apos;)</span>
</code></pre>
<hr>
<p><strong>&#x91CA;&#x653E;&#x5BB9;&#x5668;&#x91CC;&#x7684;&#x503C; <em>the maybe helper function</em></strong></p>
<p>&#x4EA7;&#x751F;&#x4F5C;&#x7528; <em>effects</em> &#x7684;&#x51FD;&#x6570;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x53D1;&#x9001; JSON &#x6570;&#x636E;&#xFF0C;&#x8FD8;&#x662F;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x6253;&#x5370;&#x4E1C;&#x897F;&#xFF0C;&#x8FD8;&#x662F;&#x66F4;&#x6539;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x90FD;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x7ED3;&#x675F;&#x3002;&#x4F46;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x901A;&#x8FC7; return &#x628A;&#x8F93;&#x51FA;&#x4F20;&#x9012;&#x5230;&#x5916;&#x90E8;&#x4E16;&#x754C;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x8FD0;&#x884C;&#x8FD9;&#x6837;&#x6216;&#x90A3;&#x6837;&#x7684;&#x51FD;&#x6570;&#x624D;&#x80FD;&#x4F20;&#x9012;&#x51FA;&#x53BB;&#x3002;</p>
<p>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6240;&#x505A;&#x7684;&#x5DE5;&#x4F5C;&#x5C31;&#x662F;&#x83B7;&#x53D6;&#x3001;&#x66F4;&#x6539;&#x548C;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#x76F4;&#x5230;&#x4E0D;&#x518D;&#x9700;&#x8981;&#x5B83;&#x4EEC;&#xFF0C;&#x5BF9;&#x6570;&#x636E;&#x505A;&#x8FD9;&#x4E9B;&#x64CD;&#x4F5C;&#x7684;&#x51FD;&#x6570;&#x6709;&#x53EF;&#x80FD;&#x88AB; map &#x8C03;&#x7528;&#xFF0C;&#x8FD9;&#x6837;&#x6570;&#x636E;&#x5C31;&#x53EF;&#x4EE5;&#x4E0D;&#x7528;&#x79BB;&#x5F00;&#x5BB9;&#x5668;&#x3002;&#x6709;&#x4E00;&#x79CD;&#x5E38;&#x89C1;&#x7684;&#x9519;&#x8BEF;&#x662F;&#x8BD5;&#x56FE;&#x4EE5;&#x5404;&#x79CD;&#x65B9;&#x6CD5;&#x5220;&#x9664; Maybe &#x91CC;&#x9762;&#x7684;&#x503C;&#xFF0C;&#x4ECE;&#x800C;&#x80FD;&#x5F97;&#x5230;&#x4E00;&#x79CD;&#x786E;&#x5B9A;&#x6027;&#x3002;&#x4F46;&#x8981;&#x660E;&#x767D;&#x7684;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x50CF;&#x859B;&#x5B9A;&#x8C14;&#x7684;&#x732B;&#x4E00;&#x6837;&#xFF0C;&#x5728;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;&#x65F6;&#x95F4;&#x70B9;&#x6709;&#x4E24;&#x79CD;&#x72B6;&#x6001;&#xFF0C;&#x800C;&#x4E14;&#x5E94;&#x8BE5;&#x4FDD;&#x6301;&#x8FD9;&#x79CD;&#x72B6;&#x6001;&#x4E0D;&#x53D8;&#x76F4;&#x5230;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x4E3A;&#x6B62;&#x3002;&#x8FD9;&#x6837;&#xFF0C;&#x54EA;&#x6015;&#x4EE3;&#x7801;&#x6709;&#x5F88;&#x591A;&#x903B;&#x8F91;&#x6027;&#x5206;&#x652F;&#xFF0C;&#x4E5F;&#x80FD;&#x4FDD;&#x8BC1;&#x4E00;&#x79CD;&#x7EBF;&#x6027;&#x7684;&#x5DE5;&#x4F5C;&#x6D41;&#x3002;</p>
<p>&#x4F46;&#x5BF9;&#x4E8E;&#x5BB9;&#x5668;&#x91CC;&#x7684;&#x503C;&#x6765;&#x8BF4;&#xFF0C;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x6709;&#x4E2A;&#x51FA;&#x53E3;&#x3002;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x60F3;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#x503C;&#x7136;&#x540E;&#x8FD8;&#x80FD;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x540E;&#x7EED;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x501F;&#x52A9;&#x4E8E;&#x4E00;&#x4E2A;&#x5E2E;&#x52A9;&#x51FD;&#x6570; maybe&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// maybe :: b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b</span>
<span class="hljs-keyword">const</span> maybe = curry(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, f, m</span>) </span>{
  <span class="hljs-keyword">return</span> m.isNothing ? x : f(m.__value);
});

<span class="hljs-comment">// getTwenty :: Account -&gt; String</span>
<span class="hljs-keyword">const</span> getTwenty = compose(
  maybe(<span class="hljs-string">&apos;You are broke!&apos;</span>, finishTransaction),
  withdraw(<span class="hljs-number">20</span>),
);

getTwenty({ balance: <span class="hljs-number">200.00</span> });
<span class="hljs-comment">// =&gt; &quot;Your balance is $180.00&quot;</span>

getTwenty({ balance: <span class="hljs-number">10.00</span> });
<span class="hljs-comment">// =&gt; &quot;You are broke!&quot;</span>
</code></pre>
<p>&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x8981;&#x4E48;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x503C;&#xFF0C;&#x4E0E; finishTransaction &#x8FD4;&#x56DE;&#x503C;&#x7684;&#x7C7B;&#x578B;&#x4E00;&#x81F4;&#xFF0C;&#x8981;&#x4E48;&#x7EE7;&#x7EED;&#x5728;&#x6CA1;&#x6709; Maybe &#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5B8C;&#x6210;&#x4EA4;&#x6613;&#x3002;maybe &#x4F7F;&#x6211;&#x4EEC;&#x5F97;&#x4EE5;&#x907F;&#x514D;&#x666E;&#x901A; map &#x90A3;&#x79CD;&#x547D;&#x4EE4;&#x5F0F;&#x7684; if/else &#x8BED;&#x53E5;&#xFF1A;if (x !== null) { return f(x) }</p>
<p>&#x771F;&#x6B63;&#x7684; Maybe &#x5B9E;&#x73B0;&#x4F1A;&#x628A;&#x5B83;&#x5206;&#x4E3A;&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#xFF1A;&#x4E00;&#x79CD;&#x662F;&#x975E;&#x7A7A;&#x503C;&#xFF0C;&#x4E00;&#x79CD;&#x662F;&#x7A7A;&#x503C;&#x3002;&#x8FD9;&#x79CD;&#x5B9E;&#x73B0;&#x5141;&#x8BB8;&#x6211;&#x4EEC;&#x9075;&#x5B88; map &#x7684; parametricity &#x7279;&#x6027;&#xFF0C;&#x56E0;&#x6B64; null &#x548C; undefined &#x80FD;&#x591F;&#x4F9D;&#x7136;&#x88AB; map &#x8C03;&#x7528;&#xFF0C;functor &#x91CC;&#x9762;&#x7684;&#x503C;&#x6240;&#x9700;&#x7684;&#x90A3;&#x79CD;&#x666E;&#x904D;&#x6027;&#x6761;&#x4EF6;&#x4E5F;&#x80FD;&#x5F97;&#x5230;&#x6EE1;&#x8DB3;&#x3002;&#x6240;&#x4EE5;&#x4F1A;&#x7ECF;&#x5E38;&#x770B;&#x89C1; Some(x) / None &#x6216;&#x8005; Just(x) / Nothing &#x8FD9;&#x6837;&#x7684;&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#x5728;&#x505A;&#x7A7A;&#x503C;&#x68C0;&#x67E5;&#xFF0C;&#x800C;&#x4E0D;&#x662F; Maybe&#x3002;</p>
<hr>
<p><strong>Either <em>(one kind of functor)</em> &#x7EAF;&#x9519;&#x8BEF;&#x5904;&#x7406;</strong></p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> Left = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) </span>{
  <span class="hljs-keyword">this</span>.__value = x;
}

Left.of = x =&gt; <span class="hljs-keyword">new</span> Left(x);

Left.prototype.map = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
}

<span class="hljs-keyword">const</span> Right = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) </span>{
  <span class="hljs-keyword">this</span>.__value = x;
}

Right.of = x =&gt; <span class="hljs-keyword">new</span> Right(x);

Rgiht.prototype.map = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>) </span>{
  <span class="hljs-keyword">return</span> Right.of(f(<span class="hljs-keyword">this</span>.__value));
}
</code></pre>
<p>Left &#x548C; Right &#x88AB;&#x79F0;&#x4E4B;&#x4E3A; Either &#x7684;&#x62BD;&#x8C61;&#x7C7B;&#x578B;&#x7684;&#x4E24;&#x4E2A;&#x5B50;&#x7C7B;&#x3002;Left &#x65E0;&#x89C6; map &#x7684;&#x8BF7;&#x6C42;&#xFF0C;Right &#x50CF;&#x4E00;&#x4E2A; Container&#xFF0C;&#x4F46;&#x5728;&#x8FD9;&#x91CC; Left &#x6709;&#x80FD;&#x529B;&#x5728;&#x5185;&#x90E8;&#x5D4C;&#x5165;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;moment&apos;</span>);

<span class="hljs-comment">// getAge :: Date -&gt; User -&gt; Either(String, Number)</span>
<span class="hljs-keyword">const</span> getAge = curry((now, user) =&gt; {
  <span class="hljs-keyword">const</span> birthdate = moment(user.birthdate, <span class="hljs-string">&apos;YYYY-MM-DD&apos;</span>);
  <span class="hljs-keyword">if</span> (!birthdate.isValid()) <span class="hljs-keyword">return</span> Left.of(<span class="hljs-string">&apos;Birth date could not be parsed&apos;</span>);
  <span class="hljs-keyword">return</span> Right.of(now.diff(birthdate, <span class="hljs-string">&apos;years&apos;</span>));
});

getAge(moment(), { birthdate: <span class="hljs-string">&apos;2005-12-12&apos;</span> });
<span class="hljs-comment">// =&gt; Right(14)</span>

getAge(moment(), { birthdate: <span class="hljs-string">&apos;balloons!&apos;</span> });
<span class="hljs-comment">// =&gt; Left(&quot;Birth date could not be parsed&quot;)</span>
</code></pre>
<p>&#x5F53;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; Left &#x7684;&#x65F6;&#x5019;&#x5C31;&#x76F4;&#x63A5;&#x8BA9;&#x7A0B;&#x5E8F;&#x77ED;&#x8DEF;&#x3002;&#x6709;&#x4E00;&#x4EF6;&#x4E8B;&#x8981;&#x6CE8;&#x610F;&#xFF0C;&#x8FD9;&#x91CC;&#x8FD4;&#x56DE;&#x7684;&#x662F; Either(String, Number)&#xFF0C;&#x610F;&#x5473;&#x7740;&#x6211;&#x4EEC;&#x8FD9;&#x4E2A; Either &#x5DE6;&#x8FB9;&#x662F; String&#xFF0C;&#x53F3;&#x8FB9; <em>right</em> &#x662F; Number&#x3002;&#x8FD9;&#x4E2A;&#x7C7B;&#x578B;&#x7B7E;&#x540D;&#x4E0D;&#x591F;&#x6B63;&#x5F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x6211;&#x4EEC;&#x6CA1;&#x6709;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684; Either &#x7236;&#x7C7B;&#xFF0C;&#x4F46;&#x8FD8;&#x662F;&#x80FD;&#x4ECE;&#x8FD9;&#x4E2A;&#x7C7B;&#x578B;&#x7533;&#x660E;&#x4E86;&#x89E3;&#x5230;&#x4E0D;&#x5C11;&#x60C5;&#x51B5;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// fortune :: Number -&gt; String</span>
<span class="hljs-keyword">const</span> fortune = compose(concat(<span class="hljs-string">&quot;If you survive, you will be &quot;</span>), add(<span class="hljs-number">1</span>));

<span class="hljs-comment">// zoltar :: User -&gt; Either(String, _)</span>
<span class="hljs-keyword">const</span> zoltar = compose(map(<span class="hljs-built_in">console</span>.log), map(fortune), getAge(moment()));

zoltar({ birthdate: <span class="hljs-string">&apos;2005-12-12&apos;</span> });
<span class="hljs-comment">// &quot;If you survive, you will be 10&quot;</span>
<span class="hljs-comment">// Right(undefined)</span>

zoltar({ birthdate: <span class="hljs-string">&apos;balloons!&apos;</span> });
<span class="hljs-comment">// Left(&quot;Birth date could not be parsed&quot;)</span>
</code></pre>
<p>&#x5982;&#x679C; birthdate &#x5408;&#x6CD5;&#xFF0C;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#xFF1B;&#x4E0D;&#x5408;&#x6CD5;&#xFF0C;&#x6536;&#x5230;&#x4E00;&#x4E2A; Left &#x5305;&#x88F9;&#x7740;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x3002;&#x4E00;&#x79CD;&#x5E73;&#x9759;&#x6E29;&#x548C;&#x7684;&#x65B9;&#x5F0F;&#x629B;&#x9519;&#x3002;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x6211;&#x4EEC;&#x6839;&#x636E; birthdate &#x7684;&#x5408;&#x6CD5;&#x6027;&#x6765;&#x7A7A;&#x503C;&#x4EE3;&#x7801;&#x7684;&#x903B;&#x8F91;&#x5206;&#x652F;&#xFF0C;&#x540C;&#x65F6;&#x53C8;&#x8BA9;&#x4EE3;&#x7801;&#x4ECE;&#x53F3;&#x5230;&#x5DE6;&#x7684;&#x76F4;&#x7EBF;&#x8FD0;&#x884C;&#x3002;&#x53E6;&#x5916;&#x6211;&#x4EEC;&#x5728; Right &#x5206;&#x652F;&#x7684;&#x7C7B;&#x578B;&#x7B7E;&#x540D;&#x4E2D;&#x4F7F;&#x7528; _ &#x8868;&#x793A;&#x4E00;&#x4E2A;&#x5E94;&#x8BE5;&#x5FFD;&#x7565;&#x7684;&#x503C;&#x3002;</p>
<p>&#x5C3D;&#x7BA1; fortune &#x4F7F;&#x7528;&#x4E86; Either&#xFF0C;&#x4F46;&#x5B83;&#x5BF9;&#x6BCF;&#x4E00;&#x4E2A; functor &#x8981;&#x505A;&#x4EC0;&#x4E48;&#x6BEB;&#x4E0D;&#x77E5;&#x60C5;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x5728;&#x8C03;&#x7528;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x88AB; map &#x5305;&#x88F9;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C31;&#x4F1A;&#x4ECE;&#x4E00;&#x4E2A;&#x975E; functor &#x51FD;&#x6570;&#x8F6C;&#x6362;&#x6210;&#x4E3A;&#x4EE5;&#x4E00;&#x4E2A; functor &#x51FD;&#x6570;&#x3002;&#x6211;&#x4EEC;&#x628A;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x53EB;&#x505A; <strong>lift</strong>&#x3002;&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x666E;&#x901A;&#x51FD;&#x6570;&#x66F4;&#x9002;&#x5408;&#x64CD;&#x4F5C;&#x666E;&#x901A;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x800C;&#x4E0D;&#x662F;&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#xFF0C;&#x5728;&#x5FC5;&#x8981;&#x7684;&#x65F6;&#x5019;&#x518D;&#x901A;&#x8FC7; lift &#x53D8;&#x4E3A;&#x5408;&#x9002;&#x7684;&#x5BB9;&#x5668;&#x53BB;&#x64CD;&#x4F5C;&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#x3002;&#x8FD9;&#x6837;&#x505A;&#x7684;&#x597D;&#x5904;&#x662F;&#x80FD;&#x5F97;&#x5230;&#x66F4;&#x7B80;&#x5355;&#x3001;&#x91CD;&#x7528;&#x6027;&#x66F4;&#x9AD8;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5B83;&#x4EEC;&#x80FD;&#x8FC7;&#x968F;&#x9700;&#x6C42;&#x800C;&#x53D8;&#xFF0C;&#x517C;&#x5BB9;&#x4EFB;&#x610F; functor&#x3002;</p>
<p>Either &#x5E76;&#x4E0D;&#x4EC5;&#x4EC5;&#x53EA;&#x5BF9;&#x5408;&#x6CD5;&#x6027;&#x68C0;&#x67E5;&#x8FD9;&#x79CD;&#x4E00;&#x822C;&#x6027;&#x7684;&#x9519;&#x8BEF;&#x6709;&#x6548;&#xFF0C;&#x5BF9;&#x4E00;&#x4E9B;&#x66F4;&#x4E25;&#x91CD;&#x3001;&#x80FD;&#x591F;&#x7EC8;&#x7AEF;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x9519;&#x8BEF;&#x6BD4;&#x5982;&#x6587;&#x4EF6;&#x4E22;&#x5931;&#x6216;&#x8005; socket &#x8FDE;&#x63A5;&#x65AD;&#x5F00;&#x7B49;&#xFF0C;Either &#x540C;&#x6837;&#x6548;&#x679C;&#x663E;&#x8457;&#x3002;</p>
<p>Either &#x4E0D;&#x4EC5;&#x4EC5;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x6D88;&#x606F;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x5B83;&#x8868;&#x793A;&#x4E86;&#x903B;&#x8F91;&#x6216;&#xFF0C;&#x4F53;&#x73B0;&#x4E86;&#x8303;&#x7574;&#x5B66;&#x91CC; coproduct &#x7684;&#x6982;&#x5FF5;&#x3002;</p>
<hr>
<p><strong>the either helper function</strong></p>
<pre><code class="lang-javascript"><span class="hljs-comment">// either :: (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c</span>
<span class="hljs-keyword">const</span> either = curry(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f, g, e</span>) </span>{
  <span class="hljs-keyword">switch</span>(e.constructor) {
    <span class="hljs-keyword">case</span> Left: <span class="hljs-keyword">return</span> f(e.__value);
    <span class="hljs-keyword">case</span> Right; <span class="hljs-keyword">return</span> g(e.__value);
  }
});

<span class="hljs-comment">// zoltar :: User -&gt; _</span>
cconst zoltar = compose(<span class="hljs-built_in">console</span>.log, either(id, fortune), getAge(moment()));

zoltar({ birthdate: <span class="hljs-string">&apos;2005-12-12&apos;</span> })
<span class="hljs-comment">// &quot;If you survive, you will be 10&quot;</span>
<span class="hljs-comment">// undefined</span>

zoltar({ birthdate: <span class="hljs-string">&apos;balloons!&apos;</span> });
<span class="hljs-comment">// &quot;Birth date could not be parsed&quot;</span>
<span class="hljs-comment">// undefined</span>
</code></pre>
<hr>
<p><strong>Handle effects</strong></p>
<pre><code class="lang-javascript"><span class="hljs-comment">// getFromStorage :: String -&gt; (_ -&gt; String)</span>
<span class="hljs-keyword">const</span> getFromStorage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> localStorage[key];
  }
}
</code></pre>
<p>&#x628A;&#x4F1A;&#x4EA7;&#x751F;&#x526F;&#x4F5C;&#x7528;&#x7684;&#x51FD;&#x6570;&#x5305;&#x88F9;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x91CC;&#x628A;&#x5B83;&#x53D8;&#x5F97;&#x770B;&#x8D77;&#x6765;&#x50CF;&#x4E00;&#x4E2A;&#x7EAF;&#x51FD;&#x6570;&#x3002;&#x6709;&#x4E86;&#x8FD9;&#x4E2A;&#x5305;&#x88F9;&#x51FD;&#x6570; warpper&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x8F93;&#x5165;&#x603B;&#x80FD;&#x8FD4;&#x56DE;&#x540C;&#x4E00;&#x4E2A;&#x8F93;&#x51FA;&#xFF1A;&#x4E00;&#x4E2A;&#x4ECE; localStorage &#x91CC;&#x53D6;&#x51FA;&#x67D0;&#x4E2A;&#x7279;&#x5B9A;&#x5143;&#x7D20;&#x7684;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x5F15;&#x5165; IO&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> IO = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>) </span>{
  <span class="hljs-keyword">this</span>.__value = f;
}

IO.of = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> IO(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> x;
  });
}

IO.prototype.map = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> IO(compose(f, <span class="hljs-keyword">this</span>.__value));
}
</code></pre>
<p>IO &#x7684; <code>__value</code> &#x603B;&#x662F;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x3002;&#x628A;&#x975E;&#x7EAF;&#x6267;&#x884C;&#x52A8;&#x4F5C;&#x653E;&#x5728;&#x5305;&#x88F9;&#x51FD;&#x6570;&#x91CC;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x5EF6;&#x8FDF;&#x6267;&#x884C;&#x8FD9;&#x4E2A;&#x975E;&#x7EAF;&#x52A8;&#x4F5C;&#x3002;&#x5C31;&#x8FD9;&#x4E00;&#x70B9;&#x800C;&#x8A00;&#xFF0C;&#x6211;&#x4EEC;&#x8BA4;&#x4E3A; IO &#x5305;&#x542B;&#x7684;&#x662F;&#x88AB;&#x5305;&#x88F9;&#x6267;&#x884C;&#x52A8;&#x4F5C;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5305;&#x88F9;&#x51FD;&#x6570;&#x672C;&#x8EAB;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// ioWindow :: IO Window</span>
<span class="hljs-keyword">const</span> ioWindow = <span class="hljs-keyword">new</span> IO(() =&gt; <span class="hljs-built_in">window</span>);

ioWindow.map(win =&gt; win.innerWidth);
<span class="hljs-comment">// IO(1430)</span>

ioWindow
  .map(prop(<span class="hljs-string">&apos;location&apos;</span>))
  .map(prop(<span class="hljs-string">&apos;href&apos;</span>))
  .map(split(<span class="hljs-string">&apos;/&apos;</span>));
<span class="hljs-comment">// IO([&apos;http:&apos;, &apos;&apos;, &apos;localhost:8000&apos;, &apos;blog&apos;, &apos;posts&apos;])</span>

<span class="hljs-comment">// $ :: String -&gt; IO [DOM]</span>
<span class="hljs-keyword">const</span> $ = selector =&gt; <span class="hljs-keyword">new</span> IO(() =&gt; <span class="hljs-built_in">document</span>.querySelectorAll(selector));

$(<span class="hljs-string">&apos;#myDiv&apos;</span>)
  .map(head)
  .map(div =&gt; div.innerHTML)
<span class="hljs-comment">// IO(&apos;I am some inner html&apos;)</span>
</code></pre>
<pre><code class="lang-javascript"><span class="hljs-comment">// url :: IO String</span>
<span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> IO(() =&gt; <span class="hljs-built_in">window</span>.location.href);

<span class="hljs-comment">// toPairs = String =&gt; [[String]]</span>
<span class="hljs-keyword">const</span> toPairs = compose(
  map(split(<span class="hljs-string">&apos;=&apos;</span>)),
  split(<span class="hljs-string">&apos;&amp;&apos;</span>),
);

<span class="hljs-comment">// params :: String -&gt; [[String]]</span>
<span class="hljs-keyword">const</span> params = compose(
  toPairs,
  last,
  split(<span class="hljs-string">&apos;?&apos;</span>),
);

<span class="hljs-comment">// findParam :: String -&gt; IO Maybe [String]</span>
<span class="hljs-keyword">const</span> findParam = key =&gt; map(
  compose(
    Maybe.of,
    filter(
      compose(
        eq(key),
        head,
      ),
    ),
    params,
  ),
  url,
);

<span class="hljs-comment">// &#x8C03;&#x7528; __value() &#x6765;&#x8FD0;&#x884C;</span>
findParam(<span class="hljs-string">&apos;searchTerm&apos;</span>).__value();
<span class="hljs-comment">// Maybe([&apos;searchTerm&apos;, &apos;wafflehouse&apos;])</span>
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x6C47;&#x603B;&#x6211;&#x4EEC;&#x628A; url &#x5305;&#x88F9;&#x5728;&#x4E00;&#x4E2A; IO &#x91CC;&#xFF0C;&#x7136;&#x540E;&#x4F20;&#x7ED9;&#x4E86;&#x8C03;&#x7528;&#x8005;&#x3002;&#x540C;&#x65F6;&#x6211;&#x4EEC;&#x4E5F;&#x538B;&#x6808;&#x4E86;&#x5BB9;&#x5668;&#xFF0C;&#x521B;&#x5EFA;&#x4E86;&#x4E00;&#x4E2A; IO(Maybe([x]))&#xFF0C;&#x6700;&#x540E;&#x8FD9;&#x4E2A;&#x6808;&#x6709;&#x4E09;&#x5C42; functor&#x3002;</p>
<p>IO &#x7684; <code>__value</code> &#x5E76;&#x4E0D;&#x662F;&#x5B83;&#x5305;&#x542B;&#x7684;&#x503C;&#xFF0C;&#x4E5F;&#x4E0D;&#x662F;&#x50CF;&#x4E24;&#x4E2A;&#x4E0B;&#x5212;&#x7EBF;&#x6697;&#x793A;&#x662F;&#x4E00;&#x4E2A;&#x79C1;&#x6709;&#x5C5E;&#x6027;&#x3002;<code>__value</code> &#x662F;&#x624B;&#x69B4;&#x5F39;&#x7684;&#x5F39;&#x6813;&#xFF0C;&#x53EA;&#x5E94;&#x8BE5;&#x88AB;&#x8C03;&#x7528;&#x8005;&#x4EE5;&#x6700;&#x516C;&#x5F00;&#x7684;&#x65B9;&#x5F0F;&#x62C9;&#x52A8;&#x3002;&#x4E3A;&#x4E86;&#x63D0;&#x9192;&#x7528;&#x6237;&#x5B83;&#x7684;&#x53D8;&#x5316;&#x65E0;&#x5E38;&#xFF0C;&#x6211;&#x4EEC;&#x628A;&#x5B83;&#x91CD;&#x547D;&#x540D;&#x4E3A; unsafePerformIO &#x770B;&#x770B;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> IO = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>) </span>{
  <span class="hljs-keyword">this</span>.unsafePerformIO = f;
}

IO.prototype.map = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> IO(compose(f, <span class="hljs-keyword">this</span>.unsafePerformIO));
}
</code></pre>
<p>&#x73B0;&#x5728;&#x8C03;&#x7528;&#x4EE3;&#x7801;&#x53D8;&#x6210;&#x4E86; <code>findParam(&apos;searchTerm&apos;).unsafePerformIO()</code>&#xFF0C;&#x8FD9;&#x6837;&#x5BF9;&#x4E8E;&#x7A0B;&#x5E8F;&#x7684;&#x7528;&#x6237;&#x6765;&#x8BF4;&#xFF0C;&#x4E0D;&#x80FD;&#x66F4;&#x76F4;&#x767D;&#x4E86;&#x3002;</p>
<hr>
<p><strong>&#x5F02;&#x6B65;&#x4EFB;&#x52A1;</strong></p>
<p>&#x6CA1;&#x4EBA;&#x559C;&#x6B22; callback hell&#x3002;&#x501F;&#x7528; Quildreen Motta &#x7684; <a href="https://github.com/origamitower/folktale" target="_blank">Folktale</a> &#x91CC;&#x9762;&#x7684; <code>Data.Task</code> &#x6765;&#x89E3;&#x91CA;&#x4E00;&#x4E0B;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;fs&apos;</span>);

<span class="hljs-comment">// callback style</span>
<span class="hljs-comment">// readFile :: String -&gt; Task(Error, JSON)</span>
<span class="hljs-keyword">const</span> readFile = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filename</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Task(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">reject, result</span>) </span>{
    fs.readFile(filename, <span class="hljs-string">&apos;utf-8&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
      err ? reject(err) : result(data);
    });
  });
};

readFile(<span class="hljs-string">&apos;metamorphosis&apos;</span>).map(split(<span class="hljs-string">&apos;\n&apos;</span>)).map(head);

<span class="hljs-comment">// callback style</span>
<span class="hljs-comment">// getJSON :: String -&gt; {} -&gt; Task(Error, JSON)</span>
<span class="hljs-keyword">const</span> getJSON = curry(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">url, params</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Task(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">reject, result</span>) </span>{
    $.getJSON(url, params, result).fail(reject);
  });
});

getJSON(<span class="hljs-string">&apos;/video&apos;</span>, { id: <span class="hljs-number">10</span> }).map(prop(<span class="hljs-string">&apos;title&apos;</span>));
</code></pre>
<p>&#x91CC;&#x9762;&#x7684; Task &#x7684; map &#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x7C7B;&#x6BD4;&#x4E8E; Promise &#x7684; then&#x3002;Task &#x7684;&#x5DE5;&#x4F5C;&#x65B9;&#x5F0F;&#x548C; IO &#x6BEB;&#x65E0;&#x5DEE;&#x522B;&#xFF0C;&#x90FD;&#x662F;&#x628A;&#x5BF9;&#x672A;&#x6765;&#x7684;&#x64CD;&#x4F5C;&#x653E;&#x5728;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x80F6;&#x56CA;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// blogPage :: Posts -&gt; HTML</span>
<span class="hljs-keyword">const</span> blogPage = Handlebars.compile(blogTemplate);

<span class="hljs-comment">// renderPage :: Posts -&gt; HTML</span>
<span class="hljs-keyword">const</span> renderPage = compose(
  blogPage,
  sortBy(<span class="hljs-string">&apos;date&apos;</span>),
);

<span class="hljs-comment">// blog :: Params -&gt; Task(Error, HTML)</span>
<span class="hljs-keyword">const</span> blog = compose(
  map(renderPage),
  getJSON(<span class="hljs-string">&apos;/posts&apos;</span>),
);

<span class="hljs-comment">// Impure calling</span>
blog({}).fork(
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{ $(<span class="hljs-string">&apos;#errlr&apos;</span>).html(error.message) },
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">page</span>) </span>{ $(<span class="hljs-string">&apos;#main&apos;</span>).html(page) }
);
$(<span class="hljs-string">&apos;#spinner&apos;</span>).show();
</code></pre>
<p>&#x8C03;&#x7528; fork &#x6765;&#x8FD0;&#x884C; Task&#xFF0C;&#x8FD9;&#x79CD;&#x673A;&#x5236;&#x4E0E; unsafePerformIO &#x7C7B;&#x4F3C;&#xFF0C;&#x4E0D;&#x540C;&#x7684;&#x5730;&#x65B9;&#x5728;&#x4E8E; fork &#x662F; fork &#x4E00;&#x4E2A;&#x5B50;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C;&#x5B83;&#x63A5;&#x6536;&#x5230;&#x7684;&#x53C2;&#x6570;&#x4EE3;&#x7801;&#xFF0C;&#x5176;&#x4ED6;&#x90E8;&#x5206;&#x7684;&#x6267;&#x884C;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#xFF0C;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E5F;&#x4E0D;&#x4F1A;&#x963B;&#x585E;&#x3002;</p>
<p>&#x8C03;&#x7528; fork &#x540E;&#xFF0C;Task &#x5C31;&#x4F1A;&#x53BB;&#x627E;&#x4E00;&#x4E9B;&#x6587;&#x7AE0;&#xFF0C;&#x6E32;&#x67D3;&#x5230;&#x9875;&#x9762;&#x4E0A;&#xFF0C;&#x4E0E;&#x6B64;&#x540C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x9875;&#x9762;&#x4E0A;&#x73B0;&#x5B9E;&#x4E00;&#x4E2A; spinner&#xFF0C;&#x56E0;&#x4E3A; fork &#x4E0D;&#x4F1A;&#x7B49;&#x6536;&#x5230;&#x4E86;&#x54CD;&#x5E94;&#x540E;&#x624D;&#x6267;&#x884C;&#x5B83;&#x540E;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x6700;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x4E48;&#x628A;&#x6587;&#x7AE0;&#x5C55;&#x793A;&#x5728;&#x9875;&#x9762;&#x4E0A;&#xFF0C;&#x8981;&#x4E48;&#x5C31;&#x663E;&#x793A;&#x4E00;&#x4E2A;&#x51FA;&#x9519;&#x4FE1;&#x606F;&#x3002;</p>
<p>&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x4ECE;&#x4E0B;&#x8BFB;&#x5230;&#x4E0A;&#xFF0C;&#x4ECE;&#x53F3;&#x5230;&#x5DE6;&#x5C31;&#x80FD;&#x7406;&#x89E3;&#x4EE3;&#x7801;&#xFF0C;&#x5373;&#x4FBF;&#x8FD9;&#x6BB5;&#x7A0B;&#x5E8F;&#x5B9E;&#x9645;&#x4E0A;&#x4F1A;&#x5728;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x4E2D;&#x8DF3;&#x6765;&#x8DF3;&#x53BB;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x7684;&#x9605;&#x8BFB;&#x548C;&#x7406;&#x89E3;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x4EE3;&#x7801;&#x6BD4;&#x90A3;&#x79CD;&#x8981;&#x5728;&#x5404;&#x79CD;&#x56DE;&#x8C03;&#x548C;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x4EE3;&#x7801;&#x4E4B;&#x95F4;&#x8DF3;&#x8DC3;&#x7684;&#x65B9;&#x5F0F;&#x8981;&#x5BB9;&#x6613;&#x7684;&#x591A;&#x3002;&#x4F60;&#x4E5F;&#x4F1A;&#x53D1;&#x73B0; Task &#x91CC;&#x9762;&#x5305;&#x542B;&#x4E86; Either&#xFF0C;&#x4E3A;&#x4E86;&#x80FD;&#x5904;&#x7406;&#x5C06;&#x6765;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x7684;&#x9519;&#x8BEF;&#xFF0C;&#x5B83;&#x5FC5;&#x987B;&#x5F97;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x56E0;&#x4E3A;&#x666E;&#x901A;&#x7684;&#x63A7;&#x5236;&#x6D41;&#x5728;&#x5F02;&#x6B65;&#x4E16;&#x754C;&#x91CC;&#x4E0D;&#x9002;&#x7528;&#x3002;</p>
<p>&#x518D;&#x770B;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// Postgres.connect :: Url -&gt; IO DbConnection</span>
<span class="hljs-comment">// runQuery :: DbConnection -&gt; ResultSet</span>
<span class="hljs-comment">// readFile :: String -&gt; Task Error String</span>

<span class="hljs-comment">// dbUrl :: Config -&gt; Either Error Url</span>
<span class="hljs-keyword">const</span> dbUrl = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>) </span>{
  <span class="hljs-keyword">return</span> (c.uname &amp;&amp; c.pass &amp;&amp; c.host &amp;&amp; c.db)
    ? Right.of(<span class="hljs-string">`db:pg://<span class="hljs-subst">${c.name}</span>:<span class="hljs-subst">${c.pass}</span>@<span class="hljs-subst">${c.host}</span>5432/<span class="hljs-subst">${c.db}</span>`</span>)
    : Left.of(<span class="hljs-built_in">Error</span>(<span class="hljs-string">&apos;Invalid Config&apos;</span>));
}

<span class="hljs-comment">// connectDb :: Config -&gt; Either Error (IO DbConnection)</span>
<span class="hljs-keyword">const</span> connectDb = compose(
  map(Postgre.connect),
  dbUrl,
);

<span class="hljs-comment">// getConfig :: Filename -&gt; Task Error (Either Error (IO DbConnection))</span>
<span class="hljs-keyword">const</span> getConfig = compose(
  map(compose(
    connectDb,
    <span class="hljs-built_in">JSON</span>.parse,
  )),
  readFile,
);

<span class="hljs-comment">// Impure calling</span>
getConfig(<span class="hljs-string">&apos;db.json&apos;</span>).fork(
  logErr(<span class="hljs-string">&apos;could not read file&apos;</span>),
  either(<span class="hljs-built_in">console</span>.log, map(runQuery)),
);
</code></pre>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#x6211;&#x4EEC;&#x5728; readFile &#x6210;&#x529F;&#x7684;&#x4EE3;&#x7801;&#x5206;&#x652F;&#x91CC;&#x5229;&#x7528;&#x4E86; Either &#x548C; IO&#x3002;Task &#x5904;&#x7406;&#x4E00;&#x6B65;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#x8FD9;&#x4E00;&#x64CD;&#x4F5C;&#x7684;&#x4E0D;&#x7EAF;&#x6027;&#xFF0C;&#x4F46;&#x662F;&#x9A8C;&#x8BC1; config &#x7684;&#x5408;&#x6CD5;&#x6027;&#x4EE5;&#x53CA;&#x8FDE;&#x63A5;&#x6570;&#x636E;&#x5E93;&#x5219;&#x5206;&#x522B;&#x4F7F;&#x7528;&#x4E86; Either &#x548C; IO&#x3002;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x4F9D;&#x7136;&#x5728;&#x540C;&#x6B65;&#x7684;&#x548C;&#x6240;&#x6709;&#x4E8B;&#x7269;&#x6253;&#x4EA4;&#x9053;&#x3002;</p>
<hr>
<p><strong>&#x4E00;&#x70B9;&#x7406;&#x8BBA;</strong></p>
<p>functor &#x6982;&#x5FF5;&#x6765;&#x81EA;&#x4E8E;&#x8303;&#x7574;&#x5B66;&#xFF0C;&#x5E76;&#x6EE1;&#x8DB3;&#x4E00;&#x4E9B;&#x5B9A;&#x5F8B;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// identity</span>
map(id) === id;

<span class="hljs-comment">// composition</span>
compose(map(f), map(g)) === map(compose(f, g));
</code></pre>
<p>&#x5728;&#x8303;&#x7574;&#x5B66;&#x4E2D;&#xFF0C;functor &#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x8303;&#x7574;&#x7684;&#x5BF9;&#x8C61;&#x548C;&#x6001;&#x5C04;(morphism)&#xFF0C;&#x7136;&#x540E;&#x628A;&#x5B83;&#x4EEC;&#x6620;&#x5C04;(map)&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x8303;&#x7574;&#x91CC;&#x53BB;&#x3002;&#x6839;&#x636E;&#x5B9A;&#x4E49;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B0;&#x8303;&#x7574;&#x4E00;&#x5B9A;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x5355;&#x4F4D;&#x5143;(identity)&#xFF0C;&#x4E5F;&#x4E00;&#x5B9A;&#x80FD;&#x591F;&#x7EC4;&#x5408;&#x6001;&#x5C04;&#x3002;</p>
<p>&#x4F60;&#x53EF;&#x4EE5;&#x628A;&#x8303;&#x7574;&#x60F3;&#x8C61;&#x6210;&#x4E00;&#x4E2A;&#x6709;&#x7740;&#x591A;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x7F51;&#x7EDC;&#xFF0C;&#x5BF9;&#x8C61;&#x4E4B;&#x95F4;&#x9760;&#x6001;&#x5C04;&#x8FDE;&#x63A5;&#x3002;&#x90A3;&#x4E48; functor &#x53EF;&#x4EE5;&#x628A;&#x4E00;&#x4E2A;&#x8303;&#x7574;&#x6620;&#x5C04;&#x5230;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#xFF0C;&#x800C;&#x4E14;&#x4E0D;&#x4F1A;&#x7834;&#x574F;&#x539F;&#x6709;&#x7684;&#x7F51;&#x7EDC;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61; a &#x5C5E;&#x4E8E;&#x6E90;&#x8303;&#x7574; C&#xFF0C;&#x90A3;&#x4E48;&#x901A;&#x8FC7; functor F &#x628A; a &#x6620;&#x5C04;&#x5230;&#x76EE;&#x6807;&#x8303;&#x7574; D &#x4E0A;&#x4E4B;&#x540E;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; F a &#x6765;&#x6307;&#x4EE3; a &#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#xFF0C;Maybe &#x5C31;&#x662F;&#x628A;&#x7C7B;&#x578B;&#x548C;&#x51FD;&#x6570;&#x7684;&#x8303;&#x7574;&#x6620;&#x5C04;&#x5230;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x8303;&#x7574;&#xFF1A;&#x5373;&#x6BCF;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x6709;&#x53EF;&#x80FD;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x6BCF;&#x4E2A;&#x6001;&#x5C04;&#x90FD;&#x6709;&#x7A7A;&#x503C;&#x68C0;&#x67E5;&#x7684;&#x8303;&#x7574;&#x3002;&#x8FD9;&#x4E2A;&#x7ED3;&#x679C;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x662F;&#x7528; map &#x5305;&#x88F9;&#x6BCF;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x7528; functor &#x5305;&#x88F9;&#x6BCF;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x3002;&#x8FD9;&#x6837;&#x5C31;&#x80FD;&#x4FDD;&#x8BC1;&#x6BCF;&#x4E2A;&#x666E;&#x901A;&#x7684;&#x7C7B;&#x578B;&#x548C;&#x51FD;&#x6570;&#x90FD;&#x80FD;&#x5728;&#x65B0;&#x73AF;&#x5883;&#x4E0B;&#x7EE7;&#x7EED;&#x7EC4;&#x5408;&#x4F7F;&#x7528;&#x3002;&#x4ECE;&#x6280;&#x672F;&#x4E0A;&#x8BB2;&#xFF0C;&#x4EE3;&#x7801;&#x4E2D;&#x7684; functor &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x628A;&#x8303;&#x7574;&#x6620;&#x5C04;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x7C7B;&#x578B;&#x548C;&#x51FD;&#x6570;&#x7684;&#x5B50;&#x8303;&#x7574;(sub category)&#x4E0A;&#xFF0C;&#x4F7F;&#x5F97;&#x8FD9;&#x4E9B; funtor &#x6210;&#x4E3A;&#x4E86;&#x4E00;&#x79CD;&#x65B0;&#x7684;&#x7279;&#x6B8A;&#x7684; endofunctor&#x3002;</p>
<pre><code>a -&gt; f -&gt; b
a -&gt; F.of -&gt; F a
b -&gt; F.of -&gt; F b
F a -&gt; map(f) -&gt; F b
</code></pre><p>&#x901A;&#x8FC7;&#x4E0A;&#x56FE;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x5B83;&#x7B26;&#x5408;&#x4EA4;&#x6362;&#x5F8B;&#x3002;&#x8FD9;&#x79CD;&#x5F62;&#x5F0F;&#x5316;&#x7ED9;&#x6211;&#x4EEC;&#x539F;&#x5219;&#x6027;&#x7684;&#x65B9;&#x5F0F;&#x53BB;&#x601D;&#x8003;&#x4EE3;&#x7801;&#xFF0C;&#x65E0;&#x987B;&#x5206;&#x6790;&#x548C;&#x8BC4;&#x4F30;&#x6BCF;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x76F4;&#x63A5;&#x5957;&#x7528;&#x5E94;&#x7528;&#x516C;&#x5F0F;&#x5373;&#x53EF;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// topRoute :: String -&gt; Maybe(String)</span>
<span class="hljs-keyword">const</span> topRoute = compose(
  Mabe.of,
  reverse,
);

<span class="hljs-comment">// bottomRoute :: String -&gt; Maybe(String)</span>
<span class="hljs-keyword">const</span> bottomRoute = compose(
  map(reverse),
  Maybe.of,
);


topRoute(<span class="hljs-string">&apos;hi&apos;</span>);
<span class="hljs-comment">// Maybe(&apos;ih&apos;)</span>

bottomRoute(<span class="hljs-string">&apos;hi&apos;</span>);
<span class="hljs-comment">// Maybe(&apos;ih&apos;)</span>
</code></pre>
<p>&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x8F6C;&#x6362;&#x4E3A;&#x56FE;&#x4F8B;&#xFF1A;</p>
<pre><code>&apos;hi&apos; -&gt; reverse -&gt; &apos;ih&apos;
&apos;hi&apos; -&gt; Maybe.of -&gt; Maybe(&apos;hi&apos;)
&apos;ih&apos; -&gt; Maybe.of -&gt; Maybe(&apos;ih&apos;)
Maybe(&apos;hi&apos;) -&gt; map(reverse) -&gt; Maybe(&apos;ih&apos;)
</code></pre><p>&#x6839;&#x636E;&#x8FD9;&#x79CD;&#x7279;&#x6027;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x7ACB;&#x5373;&#x7406;&#x89E3;&#x4EE3;&#x7801;&#x6216;&#x91CD;&#x6784;&#x3002;</p>
<p>functor &#x4E5F;&#x80FD;&#x5D4C;&#x5957;&#x4F7F;&#x7528;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> nested = Task.of([
  Right.of(<span class="hljs-string">&apos;pillows&apos;</span>),
  Left,<span class="hljs-keyword">of</span>(<span class="hljs-string">&apos;no sleep for you&apos;</span>),
]);

map(map(map(toUpperCase)), nested);
<span class="hljs-comment">// Task([Right(&apos;PILLOWS&apos;), Left(&apos;no sleep for you&apos;)])</span>

<span class="hljs-comment">// 1st map: map on Task.of, get [Right.of(&apos;pillows&apos;), Left.of(&apos;no sleep for you&apos;)]</span>
<span class="hljs-comment">// 2nd map: map on Array, iterate Right.of(&apos;pillows&apos;), Left.of(&apos;no sleep for you&apos;)</span>
<span class="hljs-comment">// 3rd map: map on Either, Right(&apos;pillow&apos;), Left(&apos;no sleep for you&apos;)</span>
</code></pre>
<p>&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x8981; map(map(map(f))) &#x624D;&#x80FD;&#x6700;&#x7EC8;&#x8FD0;&#x884C;&#x51FD;&#x6570;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x60F3;&#x8FD9;&#x4E48;&#x505A;&#xFF0C;&#x53EF;&#x4EE5;&#x7EC4;&#x5408; functor&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> Compose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f_g_x</span>) </span>{
  <span class="hljs-keyword">this</span>.getCompose = f_g_x;
}

Compose.prototype.map = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Compose(map(map(f), <span class="hljs-keyword">this</span>.getCompose));
}

<span class="hljs-keyword">const</span> tmd = Task.of(Maybe.of(<span class="hljs-string">&apos;Rock over London&apos;</span>));
<span class="hljs-keyword">const</span> ctmd = <span class="hljs-keyword">new</span> Compose(tmd);

map(concat(<span class="hljs-string">&apos;, rock on, Chicago&apos;</span>), ctmd);
<span class="hljs-comment">// Compose(Task(Maybe(&apos;Rock over London, rock on, Chicago&apos;)))</span>

ctmd.getCompose;
<span class="hljs-comment">// Task(Maybe(&apos;Rock over London, rock on, Chicago&apos;))</span>
</code></pre>
<p>functor &#x7EC4;&#x5408;&#x662F;&#x7B26;&#x5408;&#x7ED3;&#x5408;&#x5F8B;&#x7684;&#xFF0C;&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x5B9A;&#x4E49;&#x7684; Container &#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x53EB; Identity &#x7684; functor&#x3002;identity &#x548C;&#x53EF;&#x7ED3;&#x5408;&#x7684;&#x7EC4;&#x5408;&#x4E5F;&#x80FD;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x8303;&#x7574;&#xFF0C;&#x8FD9;&#x4E2A;&#x989D;&#x5934;&#x4E66;&#x7684;&#x8303;&#x7574;&#x7684;&#x5BF9;&#x8C61;&#x662F;&#x5176;&#x4ED6;&#x8303;&#x7574;&#xFF0C;&#x6001;&#x5C04;&#x662F; functor&#x3002;</p>
<h2 id="9-monad">9) Monad</h2>
<p><strong>pointed functor</strong></p>
<p>&#x4E4B;&#x524D;&#x6211;&#x4EEC;&#x521B;&#x5EFA;&#x7684;&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#x7684; of &#x65B9;&#x6CD5;&#xFF0C;&#x4E0D;&#x662F;&#x7528;&#x6765;&#x907F;&#x514D;&#x4F7F;&#x7528; new &#x5173;&#x952E;&#x5B57;&#x7684;&#xFF0C;&#x800C;&#x662F;&#x7528;&#x6765;&#x628A;&#x503C;&#x653E;&#x5230;&#x9ED8;&#x8BA4;&#x6700;&#x5C0F;&#x5316;&#x4E0A;&#x4E0B;&#x6587;(default minimal context)&#x4E2D;&#x3002;of &#x6CA1;&#x6709;&#x771F;&#x6B63;&#x7684;&#x53D6;&#x4EE3;&#x6784;&#x9020;&#x5668;&#xFF0C;&#x800C;&#x662F;&#x4E00;&#x4E2A;&#x6211;&#x4EEC;&#x79F0;&#x4E4B;&#x4E3A; pointed &#x7684;&#x91CD;&#x8981;&#x63A5;&#x53E3;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</p>
<p>pointed functor &#x662F;&#x5B9E;&#x73B0;&#x4E86; of &#x65B9;&#x6CD5;&#x7684; functor&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x7684;&#x5173;&#x952E;&#x662F;&#x628A;&#x4EFB;&#x610F;&#x503C;&#x4E22;&#x5230;&#x5BB9;&#x5668;&#x91CC;&#x7136;&#x540E;&#x5F00;&#x59CB;&#x5230;&#x5904;&#x4F7F;&#x7528; map &#x7684;&#x80FD;&#x529B;&#x3002;</p>
<pre><code class="lang-javascript">IO.of(<span class="hljs-string">&apos;tetris&apos;</span>).map(concat(<span class="hljs-string">&apos; master&apos;</span>));
<span class="hljs-comment">// IO(&quot;tetris master&quot;)</span>

Maybe.of(<span class="hljs-number">123</span>).map(add(<span class="hljs-number">1</span>));
<span class="hljs-comment">// Maybe(124)</span>

Task.of([{ id: <span class="hljs-number">2</span> }, { id: <span class="hljs-number">3</span> }]).map(prop(<span class="hljs-string">&apos;id&apos;</span>));
<span class="hljs-comment">// Task([2, 3])</span>

Either.of(<span class="hljs-string">&apos;The past, present and future walk into a bar...&apos;</span>).map(concat(<span class="hljs-string">&apos;it was tense.&apos;</span>))
<span class="hljs-comment">// Right(&quot;The past, present and future walk into a bar...it was tense.&quot;)</span>
</code></pre>
<p>IO &#x548C; Task &#x7684;&#x6784;&#x9020;&#x5668;&#x63A5;&#x53D7;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x4F5C;&#x4E3A;&#x53C2;&#x6570;&#xFF0C;&#x800C; Maybe &#x548C; Either &#x7684;&#x6784;&#x9020;&#x5668;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x4EFB;&#x610F;&#x503C;&#x3002;&#x5B9E;&#x73B0;&#x8FD9;&#x79CD;&#x63A5;&#x53E3;&#x7684;&#x52A8;&#x673A;&#x662F;&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x80FD;&#x591F;&#x6709;&#x4E00;&#x79CD;&#x901A;&#x7528;&#x4E00;&#x81F4;&#x7684;&#x65B9;&#x5F0F;&#x5F80; functor &#x91CC;&#x586B;&#x503C;&#xFF0C;&#x800C;&#x4E14;&#x4E2D;&#x95F4;&#x4E0D;&#x4F1A;&#x6D89;&#x53CA;&#x5230;&#x590D;&#x6742;&#x6027;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x6D89;&#x53CA;&#x5230;&#x5BF9;&#x6784;&#x9020;&#x5668;&#x7684;&#x7279;&#x5B9A;&#x8981;&#x6C42;&#x3002;&#x201C;&#x9ED8;&#x8BA4;&#x6700;&#x5C0F;&#x5316;&#x4E0A;&#x4E0B;&#x6587;&#x201D;&#x8FD9;&#x4E2A;&#x672F;&#x8BED;&#x53EF;&#x80FD;&#x4E0D;&#x591F;&#x7CBE;&#x786E;&#xFF0C;&#x4F46;&#x662F;&#x5374;&#x5F88;&#x597D;&#x7684;&#x4F20;&#x8FBE;&#x4E86;&#x8FD9;&#x79CD;&#x7406;&#x5FF5;&#xFF1A;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x5BB9;&#x5668;&#x7C7B;&#x578B;&#x91CC;&#x7684;&#x4EFB;&#x610F;&#x503C;&#x90FD;&#x80FD;&#x53D1;&#x751F; lift&#xFF0C;&#x7136;&#x540E;&#x50CF;&#x6240;&#x6709;&#x7684; functor &#x90A3;&#x6837;&#x518D; map &#x51FA;&#x53BB;&#x3002;</p>
<p>&#x6BCF;&#x4E2A; functor &#x90FD;&#x8981;&#x6709;&#x4E00;&#x79CD;&#x628A;&#x503C;&#x653E;&#x8FDB;&#x53BB;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x4F46;&#x5BF9; Either &#x6765;&#x8BF4;&#xFF0C;&#x5B83;&#x7684;&#x65B9;&#x5F0F;&#x662F; new Right(x)&#x3002;&#x6211;&#x4EEC;&#x4E3A; Right &#x5B9A;&#x4E49; of &#x7684;&#x539F;&#x56E0;&#x662F;&#xFF0C;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x7C7B;&#x578B;&#x5BB9;&#x5668;&#x53EF;&#x4EE5; map&#xFF0C;&#x90A3;&#x5B83;&#x5C31;&#x5E94;&#x8BE5; map&#x3002;</p>
<hr>
<p><strong>&#x6DF7;&#x5408;&#x6BD4;&#x55BB;</strong></p>
<pre><code class="lang-javascript"><span class="hljs-comment">// readFile :: String -&gt; IO String</span>
<span class="hljs-keyword">const</span> readFile = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filename</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> IO(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> fs.readFileSync(filename, <span class="hljs-string">&apos;utf-8&apos;</span>);
  });
};

<span class="hljs-comment">// print :: String -&gt; IO String</span>
<span class="hljs-keyword">const</span> print = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> IO(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(x);
    <span class="hljs-keyword">return</span> x;
  });
}

<span class="hljs-comment">// cat :: IO (IO String)</span>
<span class="hljs-keyword">const</span> cat = compose(map(print), readFile);

<span class="hljs-comment">// catFirstChar :: String -&gt; IO (IO String)</span>
<span class="hljs-keyword">const</span> catFirstChar = compose(map(map(head)), cat);

cat(<span class="hljs-string">&apos;.git/config&apos;</span>)
<span class="hljs-comment">// IO(IO(&quot;[core]\nrepositoryformatversion = 0]n&quot;))</span>

catFirstChar(<span class="hljs-string">&apos;.git/config&apos;</span>)
<span class="hljs-comment">// IO(IO(&quot;[&quot;))</span>
</code></pre>
<p>&#x6211;&#x4EEC;&#x5F97;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x524D;&#x5957;&#x7684; IO&#xFF0C;&#x8981;&#x4F7F;&#x7528;&#x5B83;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B; map(map(f))&#xFF0C;&#x8981;&#x89C2;&#x5BDF;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B; unsafePerformIO().unsafePerformIO()&#x3002;</p>
<p>&#x53E6;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// safeProp :: Key -&gt; {Key : a} -&gt; Maybe a</span>
<span class="hljs-keyword">const</span> safeProp = curry(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, obj</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Maybe(obj[x]);
});

<span class="hljs-comment">// safeHead :: [a] -&gt; Maybe a</span>
<span class="hljs-keyword">const</span> safeHead = safeProp(<span class="hljs-number">0</span>);

<span class="hljs-comment">// firstAddressStreet :: User -&gt; Maybe (Maybe (Maybe Street))</span>
<span class="hljs-keyword">const</span> firstAddressStreet = compose(
  map(map(safeProp(<span class="hljs-string">&apos;street&apos;</span>))),
  map(safeHead),
  safeProp(<span class="hljs-string">&apos;addresses&apos;</span>),
);

firstAddressStreet(
  {
    address: [
      {
        street: {
          name: <span class="hljs-string">&apos;Mulburry&apos;</span>,
          number: <span class="hljs-number">8402</span>,
        },
        postcode: <span class="hljs-string">&apos;WC2N&apos;</span>,
      }
    ]
  }
);
<span class="hljs-comment">// Maybe(Maybe(Maybe({ name: &apos;Mulburry&apos;, number: 8402 })))</span>
</code></pre>
<p>&#x8FD9;&#x79CD;&#x5D4C;&#x5957; functor &#x7684;&#x6A21;&#x5F0F;&#x4F1A;&#x65F6;&#x4E0D;&#x65F6;&#x51FA;&#x73B0;&#xFF0C;&#x800C;&#x4E14;&#x662F; monad &#x7684;&#x4E3B;&#x8981;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x3002;&#x5F53;&#x78B0;&#x5230;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x53EB;&#x505A; <code>join</code> &#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> mmo = Maybe.of(Maybe.of(<span class="hljs-string">&apos;ok&apos;</span>));
<span class="hljs-comment">// Maybe(Maybe(&apos;ok&apos;))</span>

mmo.join();
<span class="hljs-comment">// Maybe(&apos;ok&apos;)</span>

<span class="hljs-keyword">const</span> ioio = IO.of(IO.of(<span class="hljs-string">&apos;pizza&apos;</span>));
<span class="hljs-comment">// IO(IO(&apos;pizza&apos;))</span>

ioio.join();
<span class="hljs-comment">// IO(&apos;pizza&apos;)</span>

<span class="hljs-keyword">const</span> ttt = Task.of(Task.of(Task.of(<span class="hljs-string">&apos;some tasks&apos;</span>)));
<span class="hljs-comment">// Task(Task(Task(&apos;some tasks&apos;)))</span>

ttt.join()
<span class="hljs-comment">// Task(Task(&apos;some tasks&apos;))</span>
</code></pre>
<p>&#x5982;&#x679C;&#x6709;&#x4E24;&#x5C42;&#x76F8;&#x540C;&#x7C7B;&#x578B;&#x7684;&#x5D4C;&#x5957;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; join &#x628A;&#x5B83;&#x4EEC;&#x538B;&#x6241;&#x9053;&#x4E00;&#x5757;&#x513F;&#x53BB;&#x3002;</p>
<p><strong>monad &#x662F;&#x53EF;&#x4EE5;&#x53D8;&#x6241;&#x7684;(flattern) pointed functor</strong></p>
<p>&#x4E00;&#x4E2A; functor&#xFF0C;&#x53EA;&#x8981;&#x5B83;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A; join &#x65B9;&#x6CD5;&#x548C;&#x4E00;&#x4E2A; of &#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x9075;&#x5B88;&#x4E00;&#x4E9B;&#x5B9A;&#x5F8B;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C31;&#x662F;&#x4E00;&#x4E2A; monad&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x6765;&#x4E3A; Maybe &#x5B9A;&#x4E49;&#x4E00;&#x4E2A; join &#x65B9;&#x6CD5;&#xFF1A;</p>
<pre><code class="lang-javascript">Maybe.prototype.join = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.isNothing() ? May.of(<span class="hljs-literal">null</span>) : <span class="hljs-keyword">this</span>.__value;
}
</code></pre>
<p>&#x4E0B;&#x9762;&#x770B;&#x4E0B; Maybe.join &#x7684;&#x5B9E;&#x9645;&#x5E94;&#x7528;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// join :: Monad m =&gt; m (m a) -&gt; m a</span>
<span class="hljs-keyword">const</span> join = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mma</span>) </span>{ <span class="hljs-keyword">return</span> mma.join(); }

<span class="hljs-comment">// firstAddressStreet :: User -&gt; Maybe Street</span>
<span class="hljs-keyword">const</span> firstAddressStreet = compose(
  join,
  map(safeProp(<span class="hljs-string">&apos;street&apos;</span>)),
  join,
  map(safeHead),
  safeProp(<span class="hljs-string">&apos;addresses&apos;</span>),
);

firstAddressStreet(
  {
    address: [
      {
        street: {
          name: <span class="hljs-string">&apos;Mulburry&apos;</span>,
          number: <span class="hljs-number">8402</span>,
        },
        postcode: <span class="hljs-string">&apos;WC2N&apos;</span>,
      }
    ]
  }
);
<span class="hljs-comment">// Maybe({ name: &apos;Mulburry&apos;, number: 8402 })</span>
</code></pre>
<p>&#x53EA;&#x8981;&#x9047;&#x5230;&#x5D4C;&#x5957;&#x7684; Maybe&#xFF0C;&#x5C31;&#x52A0;&#x4E00;&#x4E2A; join&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x518D;&#x8BD5;&#x8BD5; IO &#x7684; join&#xFF1A;</p>
<pre><code class="lang-javascript">IO.prototype.join = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.unsafePerformIO();
}

<span class="hljs-comment">// log :: a -&gt; IO a</span>
<span class="hljs-keyword">const</span> log = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> IO(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-built_in">console</span>.log(x); <span class="hljs-keyword">return</span> x; })
}

<span class="hljs-comment">// setStyle :: Selector -&gt; CSSProps -&gt; IO DOM</span>
<span class="hljs-keyword">const</span> setStyle = curry(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sel, props</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> IO(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> jQuery(sel).css(props); });
});

<span class="hljs-comment">// getItem :: String -&gt; IO String</span>
<span class="hljs-keyword">const</span> getItem = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> IO(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> localStorage.getItem(key); })
}

<span class="hljs-comment">// applyPreferences :: String -&gt; IO DOM</span>
<span class="hljs-keyword">const</span> applyPreferences = compose(
  join,
  map(setStyle(<span class="hljs-string">&apos;#main&apos;</span>)),
  join,
  map(log),
  map(<span class="hljs-built_in">JSON</span>.parse),
  getItem,
);

applyPreferences(<span class="hljs-string">&apos;preferences&apos;</span>).unsafePerformIO();
<span class="hljs-comment">// Object {backgroundColor: &apos;green&apos;}</span>
<span class="hljs-comment">// &lt;div style=&quot;background-color: &apos;green&apos;&quot; /&gt;</span>
</code></pre>
<p>getItem &#x8FD4;&#x56DE;&#x4E86;&#x4E00;&#x4E2A; IO String&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528; map &#x6765;&#x89E3;&#x6790;&#x5B83;&#x3002;log &#x548C; setStyle &#x8FD4;&#x56DE;&#x7684;&#x90FD;&#x662F; IO&#xFF0C;&#x6240;&#x4EE5;&#x5FC5;&#x987B;&#x8981;&#x7528; join &#x6765;&#x4FDD;&#x8BC1;&#x91CC;&#x9762;&#x7684;&#x5D4C;&#x5957;&#x5904;&#x4E8E;&#x63A7;&#x5236;&#x4E4B;&#x4E2D;&#x3002;</p>
<hr>
<p><strong>chain &#x51FD;&#x6570;</strong></p>
<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x603B;&#x662F;&#x5728;&#x7D27;&#x8DDF;&#x7740; map &#x540E;&#x8C03;&#x7528; join&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x8FD9;&#x4E2A;&#x884C;&#x4E3A;&#x62BD;&#x8C61;&#x5230;&#x4E00;&#x4E2A;&#x53EB;&#x505A; chain &#x7684;&#x51FD;&#x6570;&#x91CC;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> chain = curry(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f, m</span>) </span>{
  <span class="hljs-keyword">return</span> m.map(f).join();
})
</code></pre>
<p>chain &#x5728;&#x5176;&#x4ED6;&#x51FD;&#x6570;&#x5F0F;&#x7F16;&#x7A0B;&#x8BED;&#x8A00;&#x4E2D;&#x53C8;&#x79F0;&#x4E3A; <code>&gt;&gt;=</code>(&#x8BFB;&#x4F5C; bind) &#x6216;&#x8005; <code>flatMap</code>&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x4E0D;&#x540C;&#x540D;&#x79F0;&#x3002;flatMap &#x662F;&#x6700;&#x51C6;&#x786E;&#x7684;&#x540D;&#x79F0;&#xFF0C;&#x4F46;&#x540E;&#x7EED;&#x8FD8;&#x662F;&#x4F1A;&#x7EE7;&#x7EED;&#x7528; chain&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x7528; chain &#x6765;&#x91CD;&#x6784;&#x4E0A;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// map/join</span>
<span class="hljs-keyword">const</span> firstAddressStreet = compose(
  join,
  map(safeProp(<span class="hljs-string">&apos;street&apos;</span>)),
  join,
  map(safeHead),
  safeProp(<span class="hljs-string">&apos;addresses&apos;</span>),
);

<span class="hljs-comment">// chain</span>
<span class="hljs-keyword">const</span> firstAddressStreet = compose(
  chain(safeProp(<span class="hljs-string">&apos;street&apos;</span>)),
  chain(safeHead),
  safeProp(<span class="hljs-string">&apos;addresses&apos;</span>),
)

<span class="hljs-comment">// map/join</span>
<span class="hljs-keyword">const</span> applyPreferences = compose(
  join,
  map(setStyle(<span class="hljs-string">&apos;#main&apos;</span>)),
  join,
  map(log),
  map(<span class="hljs-built_in">JSON</span>.parse),
  getItem,
);

<span class="hljs-comment">// chain</span>
<span class="hljs-keyword">const</span> applyPreferences = compose(
  chain(setStyle(<span class="hljs-string">&apos;#main&apos;</span>)),
  chain(log),
  map(<span class="hljs-built_in">JSON</span>.parse),
  getItem,
);
</code></pre>
<p>chain &#x7684;&#x80FD;&#x529B;&#x4E0D;&#x6B62;&#x4E8E;&#x6B64;&#xFF0C;&#x56E0;&#x4E3A;&#x53EF;&#x4EE5;&#x8F7B;&#x677E;&#x5D4C;&#x5957;&#x591A;&#x4E2A;&#x4F5C;&#x7528;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x80FD;&#x4EE5;&#x4E00;&#x79CD;&#x7EAF;&#x51FD;&#x6570;&#x5F0F;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x8868;&#x793A;&#x5E8F;&#x5217; <code>sequence</code> &#x548C;&#x53D8;&#x91CF;&#x8D4B;&#x503C; <code>variable assignment</code>&#x3002;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// getJSON :: Url -&gt; Params -&gt; Task JSON</span>
<span class="hljs-comment">// querySelector :: Selector -&gt; IO DOM</span>

getJSON(<span class="hljs-string">&apos;/authenticate&apos;</span>, { username: <span class="hljs-string">&apos;stele&apos;</span>, password: <span class="hljs-string">&apos;crackers&apos;</span> })
  .chain(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">user</span>) </span>{
    <span class="hljs-keyword">return</span> getJSON(<span class="hljs-string">&apos;/friends&apos;</span>, { user_id: user.id });
  });
<span class="hljs-comment">// Task([{ name: &apos;Seimith&apos;, id: 14 }, { name: &apos;Ric&apos;, id: 39 }])</span>

querySelector(<span class="hljs-string">&apos;input.username&apos;</span>).chain(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">uname</span>) </span>{
  <span class="hljs-keyword">return</span> querySelector(<span class="hljs-string">&apos;input.email&apos;</span>).chain(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">email</span>) </span>{
    <span class="hljs-keyword">return</span> IO.of(
      <span class="hljs-string">`Welcome <span class="hljs-subst">${uname.value}</span> prepare for span at <span class="hljs-subst">${email.value}</span>`</span>
    );
  });
});
<span class="hljs-comment">// IO(&apos;Welcome Olivia prepare for span at olivia@somesite.com&apos;)</span>

Maybe.of(<span class="hljs-number">3</span>).chain(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">three</span>) </span>{
  <span class="hljs-keyword">return</span> Maybe.of(<span class="hljs-number">2</span>).map(add(three));
});
<span class="hljs-comment">// Maybe(5);</span>

Maybe.of(<span class="hljs-literal">null</span>).chain(safeProp(<span class="hljs-string">&apos;address&apos;</span>)).chain(safeProp(<span class="hljs-string">&apos;street&apos;</span>));
<span class="hljs-comment">// Maybe(null);</span>
</code></pre>
<p>chain &#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x4ECE;&#x4EFB;&#x610F;&#x7C7B;&#x578B;&#x7684; map &#x548C; join &#x884D;&#x751F;&#x51FA;&#x6765;&#xFF0C;&#x5C31;&#x50CF;&#x8FD9;&#x6837;&#xFF1A;t.prototype.chain = function(f) { return this.map(f).join(); }&#x3002;&#x5982;&#x679C; chain &#x662F;&#x7B80;&#x5355;&#x7684;&#x901A;&#x8FC7;&#x7ED3;&#x675F;&#x8C03;&#x7528; of &#x540E;&#x628A;&#x503C;&#x653E;&#x56DE;&#x5BB9;&#x5668;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x9020;&#x6210;&#x4E00;&#x4E2A;&#x6709;&#x8DA3;&#x7684;&#x540E;&#x679C;&#xFF0C;&#x5373;&#x53EF;&#x4EE5;&#x4ECE; chain &#x884D;&#x751F;&#x51FA;&#x4E00;&#x4E2A; map&#x3002;&#x540C;&#x6837;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x53EF;&#x4EE5;&#x7528;chain(id) &#x5B9A;&#x4E49; join&#x3002;</p>
<p>&#x603B;&#x4E4B;&#x8BB0;&#x4F4F;&#xFF0C;&#x8FD4;&#x56DE;&#x7684;&#x5982;&#x679C;&#x662F;&#x201C;&#x666E;&#x901A;&#x201D;&#x503C;&#x5C31;&#x7528; map&#xFF0C;&#x5982;&#x679C;&#x662F; functor &#x5C31;&#x7528; chain&#x3002;</p>
<hr>
<p><strong>&#x70AB;&#x8000;</strong></p>
<p>&#x8FD9;&#x79CD;&#x5BB9;&#x5668;&#x7F16;&#x7A0B;&#x98CE;&#x683C;&#x4F18;&#x52BF;&#x4E5F;&#x80FD;&#x9020;&#x6210;&#x56F0;&#x60D1;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x5F97;&#x4E0D;&#x52AA;&#x529B;&#x7406;&#x89E3;&#x4E00;&#x4E2A;&#x503C;&#x5230;&#x5E95;&#x5D4C;&#x5957;&#x4E86;&#x57FA;&#x5C42;&#x5BB9;&#x5668;&#xFF0C;&#x6216;&#x8005;&#x9700;&#x8981;&#x7528; map &#x8FD8;&#x662F; chain&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x5148;&#x770B;&#x4E00;&#x4E0B; chain &#x7684;&#x5A01;&#x529B;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// readFile :: Filename -&gt; Either String (Future Error String)</span>
<span class="hljs-comment">// httpPost :: String -&gt; Future Error JSON</span>

<span class="hljs-comment">// upload :: String -&gt; Either String (Future Error JSON)</span>
<span class="hljs-keyword">const</span> upload = compose(
  map(chain(httpPost(<span class="hljs-string">&apos;/uploads&apos;</span>))),
  readFile,
)

<span class="hljs-comment">// &#x548C;&#x547D;&#x4EE4;&#x5F0F;&#x65B9;&#x5F0F;&#x5BF9;&#x6BD4;&#x4E00;&#x4E0B;</span>
<span class="hljs-keyword">const</span> upload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filename, callback</span>) </span>{
  <span class="hljs-keyword">if</span> (!filename) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">&apos;You need a filename!&apos;</span>;
  } <span class="hljs-keyword">else</span> {
    readFile(filename, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, contents</span>) </span>{
      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
      httpPost(contents, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, json</span>) </span>{
        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
        callback(json);
      });
    });
  }
};
</code></pre>
<hr>
<p><strong>&#x7406;&#x8BBA;</strong></p>
<pre><code>// &#x7ED3;&#x5408;&#x5F8B;
compose(join, map(join)) == compose(join, join)

// &#x7528;&#x7B49;&#x5F0F;&#x63A8;&#x5BFC;&#xFF1A;
// &#x5408;&#x5E76;&#x91CC;&#x9762;&#x7684;&#x4E24;&#x4E2A; M
1. M(M(M a)) -&gt; map(join) -&gt; M(M a) -&gt; join -&gt; M a

// &#x5408;&#x5E76;&#x5916;&#x9762;&#x7684;&#x4E24;&#x4E2A; M
2. M(M(M a)) -&gt; join -&gt; M(M a) -&gt; join -&gt; M a
</code></pre><pre><code>// &#x540C;&#x4E00;&#x5F8B; (M a)
compose(join, of) == compose(join, map(of)) == id

// &#x7528;&#x7B49;&#x5F0F;&#x63A8;&#x5BFC;&#xFF1A;
// M a -&gt; of -&gt; M(M a) -&gt; join -&gt; M a
// M a -&gt; map(of) -&gt; M(M a) -&gt; join -&gt; M a
// M a -&gt; id -&gt; M a
</code></pre><pre><code class="lang-javascript"><span class="hljs-keyword">const</span> mcompose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">f, g</span>) </span>{
  <span class="hljs-keyword">return</span> compose(chain(f), chain(g));
}

<span class="hljs-comment">// &#x5DE6;&#x540C;&#x4E00;&#x5F8B;</span>
mcompose(M, f) == f

<span class="hljs-comment">// &#x53F3;&#x540C;&#x4E00;&#x5F8B;</span>
mcompose(f, M) == f

<span class="hljs-comment">// &#x7ED3;&#x5408;&#x5F8B;</span>
mcompose(mcompose(f, g), h) == mcompose(f, mcompose(g, h))
</code></pre>
<h2 id="10-applicative-functor">10) Applicative Functor</h2>
<p>&#x60F3;&#x8C61;&#x4E00;&#x4E2A;&#x573A;&#x666F;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x540C;&#x7C7B;&#x578B;&#x7684; functor&#xFF0C;&#x60F3;&#x628A;&#x8FD9;&#x4E24;&#x8005;&#x4F5C;&#x4E3A;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x7684;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x4F20;&#x9012;&#x8FC7;&#x53BB;&#x6765;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x3002;&#x6BD4;&#x5982;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// not gonna work</span>
add(Container.of(<span class="hljs-number">2</span>), Container.of(<span class="hljs-number">3</span>))
<span class="hljs-comment">// NaN</span>

<span class="hljs-comment">// Use map</span>
<span class="hljs-keyword">const</span> container_of_add_2 = map(add, Container.of(<span class="hljs-number">2</span>));
<span class="hljs-comment">// Container(add(2))</span>

Container.of(<span class="hljs-number">2</span>).chain(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">two</span>) </span>{
  <span class="hljs-keyword">return</span> Container.of(<span class="hljs-number">3</span>).map(add(two));
});
</code></pre>
<p>&#x4E0A;&#x9762;&#x4EE3;&#x7801;&#x5B58;&#x5728;&#x7684;&#x95EE;&#x9898;&#x662F;&#xFF0C;&#x6240;&#x6709;&#x4EE3;&#x7801;&#x90FD;&#x53EA;&#x4F1A;&#x5728;&#x524D;&#x4E00;&#x4E2A; monad &#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x4E4B;&#x540E;&#x624D;&#x6267;&#x884C;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x5F15;&#x5165; <code>ap</code> &#x51FD;&#x6570;&#x3002;&#x80FD;&#x591F;&#x628A;&#x4E00;&#x4E2A; functor &#x7684;&#x51FD;&#x6570;&#x503C;&#x5E94;&#x7528;&#x5230;&#x53E6;&#x4E00;&#x4E2A; functor &#x7684;&#x503C;&#x4E0A;&#x3002;</p>
<pre><code class="lang-javascript">Container.of(add(<span class="hljs-number">2</span>)).ap(Container.of(<span class="hljs-number">3</span>));
<span class="hljs-comment">// Container(5)</span>

<span class="hljs-comment">// all together now</span>
Container.of(<span class="hljs-number">2</span>).map(add).ap(Container.of(<span class="hljs-number">3</span>));
<span class="hljs-comment">// Container(5)</span>
</code></pre>
<p>&#x53EF;&#x4EE5;&#x8FD9;&#x6837;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A; ap &#x51FD;&#x6570;&#xFF1A;</p>
<pre><code class="lang-javascript">Container.prototype.ap = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">other_container</span>) </span>{
  <span class="hljs-keyword">return</span> other_container.map(<span class="hljs-keyword">this</span>.__value);
}
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: üöÄ Programming">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../Philosophy/" class="navigation navigation-next " aria-label="Next page: üèõ Philosophy">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"üìñ Professor Frisby's Mostly Adequate Guide to Functional Programming","level":"1.2.1","depth":2,"next":{"title":"üèõ Philosophy","level":"1.3","depth":1,"path":"Philosophy/README.md","ref":"Philosophy/README.md","articles":[{"title":"üí∞ Ê∂àË¥π‰∏ª‰πâ","level":"1.3.1","depth":2,"path":"Philosophy/consumerism.md","ref":"Philosophy/consumerism.md","articles":[]}]},"previous":{"title":"üöÄ Programming","level":"1.2","depth":1,"path":"Programming/README.md","ref":"Programming/README.md","articles":[{"title":"üìñ Professor Frisby's Mostly Adequate Guide to Functional Programming","level":"1.2.1","depth":2,"path":"Programming/fp-javascript.md","ref":"Programming/fp-javascript.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Programming/fp-javascript.md","mtime":"2019-12-23T10:41:30.554Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-12-23T10:44:07.411Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

